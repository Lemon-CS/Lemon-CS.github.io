<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SpringBoot-2.0学习笔记 | Lemon-CS</title><meta name="keywords" content="SpringBoot"><meta name="author" content="空白格"><meta name="copyright" content="空白格"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SpringBoot2.0入门学习笔记和新版本新特性">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot-2.0学习笔记">
<meta property="og:url" content="https://lemon-cs.github.io/2019/12/25/SpringBoot-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Lemon-CS">
<meta property="og:description" content="SpringBoot2.0入门学习笔记和新版本新特性">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2021/12/6c4bf5b41815150b.jpg">
<meta property="article:published_time" content="2019-12-25T14:09:50.000Z">
<meta property="article:modified_time" content="2020-03-25T07:37:35.000Z">
<meta property="article:author" content="空白格">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2021/12/6c4bf5b41815150b.jpg"><link rel="shortcut icon" href="https://gitee.com/lemon-cs/images/raw/master/Blog.png"><link rel="canonical" href="https://lemon-cs.github.io/2019/12/25/SpringBoot-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 空白格","link":"链接: ","source":"来源: Lemon-CS","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringBoot-2.0学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-03-25 15:37:35'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    document.addEventListener('pjax:complete', detectApple)})(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/constown/HexoCustomFile@0.0.4/dist/css/custom.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./images/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s3.bmp.ovh/imgs/2021/12/6c4bf5b41815150b.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Lemon-CS</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SpringBoot-2.0学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-12-25T14:09:50.000Z" title="发表于 2019-12-25 22:09:50">2019-12-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-03-25T07:37:35.000Z" title="更新于 2020-03-25 15:37:35">2020-03-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">28k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>120分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot-2.0学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-SpringBoot2-0入门"><a href="#1-SpringBoot2-0入门" class="headerlink" title="1-SpringBoot2.0入门"></a>1-SpringBoot2.0入门</h2><h3 id="1-1-SpringBoot2-x依赖环境和版本新特性"><a href="#1-1-SpringBoot2-x依赖环境和版本新特性" class="headerlink" title="1.1-SpringBoot2.x依赖环境和版本新特性"></a>1.1-SpringBoot2.x依赖环境和版本新特性</h3><p><strong>简介：讲解新版本依赖环境和springboot2新特性概述</strong></p>
<ul>
<li><p>1、依赖版本jdk8以上, Springboot2.x用JDK8, 因为底层是 Spring framework5</p>
</li>
<li><p>2、安装maven最新版本，maven3.2以上版本，下载地址 ：<a target="_blank" rel="noopener" href="https://maven.apache.org/download.cgi">https://maven.apache.org/download.cgi</a></p>
</li>
<li><p>3、Eclipse或者IDE</p>
</li>
<li><p>4、新特性</p>
</li>
<li><p>5、翻译工具：<a target="_blank" rel="noopener" href="https://translate.google.cn/">https://translate.google.cn/</a></p>
</li>
<li><p>6、springbootGitHub地址：<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot">https://github.com/spring-projects/spring-boot</a></p>
</li>
<li><p>7、springboot官方文档：<a target="_blank" rel="noopener" href="https://spring.io/guides/gs/spring-boot/">https://spring.io/guides/gs/spring-boot/</a></p>
</li>
</ul>
<h3 id="1-2-快速创建SpringBoot2-x应用之手工创建web应用"><a href="#1-2-快速创建SpringBoot2-x应用之手工创建web应用" class="headerlink" title="1.2-快速创建SpringBoot2.x应用之手工创建web应用"></a>1.2-快速创建SpringBoot2.x应用之手工创建web应用</h3><p><strong>简介：使用Maven手工创建SpringBoot2.x应用</strong></p>
<ul>
<li><p>手工创建:<a target="_blank" rel="noopener" href="https://projects.spring.io/spring-boot/#quick-start">https://projects.spring.io/spring-boot/#quick-start</a></p>
</li>
<li><p>官方推荐包命名接口，不要使用默认 defaultPackage</p>
</li>
<li><p>官方文档: <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#using-boot-using-the-default-package">https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#using-boot-using-the-default-package</a></p>
<ul>
<li>例子：com +- example +- myapplication +- Application.java | +- customer | +- Customer.java | +- CustomerController.java | +- CustomerService.java | +- CustomerRepository.java | +- order +- Order.java +- OrderController.java +- OrderService.java +- OrderRepository.java</li>
</ul>
</li>
</ul>
<h3 id="1-3-快速创建SpringBoot2-x应用之工具类自动创建web应用"><a href="#1-3-快速创建SpringBoot2-x应用之工具类自动创建web应用" class="headerlink" title="1.3-快速创建SpringBoot2.x应用之工具类自动创建web应用"></a>1.3-快速创建SpringBoot2.x应用之工具类自动创建web应用</h3><p><strong>简介：使用构建工具自动生成项目基本架构</strong> 工具自动创建:<a target="_blank" rel="noopener" href="http://start.spring.io/">http://start.spring.io/</a></p>
<h3 id="1-4-SpringBoot2-x的依赖默认Maven版本"><a href="#1-4-SpringBoot2-x的依赖默认Maven版本" class="headerlink" title="1.4-SpringBoot2.x的依赖默认Maven版本"></a>1.4-SpringBoot2.x的依赖默认Maven版本</h3><p><strong>简介：讲解SpringBoot2.x的默认Maven依赖版本</strong></p>
<ul>
<li>官网地址<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#appendix-dependency-versions">https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#appendix-dependency-versions</a></li>
</ul>
</li>
</ul>
<h2 id="2-SpringBoot接口Http协议开发实战"><a href="#2-SpringBoot接口Http协议开发实战" class="headerlink" title="2-SpringBoot接口Http协议开发实战"></a>2-SpringBoot接口Http协议开发实战</h2><h3 id="2-1-SpringBoot2-xHTTP请求配置讲解"><a href="#2-1-SpringBoot2-xHTTP请求配置讲解" class="headerlink" title="2.1-SpringBoot2.xHTTP请求配置讲解"></a>2.1-SpringBoot2.xHTTP请求配置讲解</h3><p><strong>简介：SpringBoot2.xHTTP请求注解讲解和简化注解配置技巧</strong></p>
<ul>
<li>@RestController and @RequestMapping是springMVC的注解，不是springboot特有的</li>
<li>@RestController = @Controller+@ResponseBody</li>
<li>@SpringBootApplication = @Configuration+@EnableAutoConfiguration+@ComponentScanlocalhost:8080</li>
</ul>
<h3 id="2-2-开发必备工具PostMan接口工具介绍和使用"><a href="#2-2-开发必备工具PostMan接口工具介绍和使用" class="headerlink" title="2.2-开发必备工具PostMan接口工具介绍和使用"></a>2.2-开发必备工具PostMan接口工具介绍和使用</h3><p>用户在开发或者调试网络程序或者是网页B/S模式的程序的时候是需要一些方法来跟踪网页请求的，用户可以使用一些网络的监视工具比如著名的Firebug等网页调试工具。今天给大家介绍的这款网页调试工具不仅可以调试简单的css、html、脚本等简单的网页基本信息，它还可以发送几乎所有类型的HTTP请求！<strong>Postman</strong>在发送网络HTTP请求方面可以说是Chrome插件类产品中的代表产品之一。</p>
<p><strong>简介：模拟Http接口测试工具PostMan安装和讲解</strong></p>
<ul>
<li>接口调试工具安装和基本使用</li>
<li>下载地址：<a target="_blank" rel="noopener" href="https://www.getpostman.com/">https://www.getpostman.com/</a></li>
</ul>
<h3 id="2-3-HTTP接口GET请求实战"><a href="#2-3-HTTP接口GET请求实战" class="headerlink" title="2.3-HTTP接口GET请求实战"></a>2.3-HTTP接口GET请求实战</h3><p><strong>简介:讲解springboot接口，http的get请求，各个注解使用</strong></p>
<ul>
<li><p>GET请求</p>
<ul>
<li>1、单一参数@RequestMapping(path = “/{id}”, method = RequestMethod.GET)</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(<span class="meta">@PathVariable</span> String id )</span> </span>&#123;&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/&#123;depid&#125;/&#123;userid&#125;&quot;, method = RequestMethod.GET)</span> </span><br><span class="line">      <span class="comment">//可以同时指定多个提交方法 </span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(<span class="meta">@PathVariable(&quot;depid&quot;)</span>String departmentID,<span class="meta">@PathVariable(&quot;userid&quot;)</span> String userid)</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(path = &quot;/&#123;city_id&#125;/&#123;user_id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">findUser</span><span class="params">(<span class="meta">@PathVariable(&quot;city_id&quot;)</span> String cityId,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="meta">@PathVariable(&quot;user_id&quot;)</span> String userId)</span> </span>&#123;</span><br><span class="line">       params.clear();</span><br><span class="line">       params.put(<span class="string">&quot;cityId&quot;</span>, cityId);</span><br><span class="line">       params.put(<span class="string">&quot;userId&quot;</span>, userId);</span><br><span class="line"> </span><br><span class="line">       <span class="keyword">return</span> params;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


<ul>
<li><p>Restful协议的GET请求</p>
<ul>
<li><p>@GetMapping注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/v1/page_user1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">pageUser</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        params.clear();</span><br><span class="line">        params.put(<span class="string">&quot;from&quot;</span>, from);</span><br><span class="line">        params.put(<span class="string">&quot;size&quot;</span>, size);</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>参数设置默认值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/v2/page_user2&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Object <span class="title">pageUser2</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;0&quot;, name = &quot;page&quot;)</span> <span class="keyword">int</span> from, <span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        params.clear();</span><br><span class="line">        params.put(<span class="string">&quot;from&quot;</span>, from);</span><br><span class="line">        params.put(<span class="string">&quot;size&quot;</span>, size);</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>获取http的头部</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/v1/get_header&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getHeader</span><span class="params">(<span class="meta">@RequestHeader(&quot;access_token&quot;)</span> String accessToken, String id)</span> </span>&#123;</span><br><span class="line">        params.clear();</span><br><span class="line">        params.put(<span class="string">&quot;access_token&quot;</span>, accessToken);</span><br><span class="line">        params.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用HttpServletRequest</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/v1/test_request&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">testRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        params.clear();</span><br><span class="line">        String id = request.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        params.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="2-4-HTTP其他提交方法请求实战"><a href="#2-4-HTTP其他提交方法请求实战" class="headerlink" title="2.4-HTTP其他提交方法请求实战"></a>2.4-HTTP其他提交方法请求实战</h3><p><strong>简介：讲解http请求post，put, delete提交方式</strong></p>
<h4 id="2-4-1-Post请求"><a href="#2-4-1-Post请求" class="headerlink" title="2.4.1-Post请求"></a>2.4.1-Post请求</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/v1/login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">login</span><span class="params">(String id, String pwd)</span> </span>&#123;</span><br><span class="line">        params.clear();</span><br><span class="line">        params.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        params.put(<span class="string">&quot;pwd&quot;</span>, pwd);</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-Put请求"><a href="#2-4-2-Put请求" class="headerlink" title="2.4.2-Put请求"></a>2.4.2-Put请求</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/v1/put&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">put</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        params.clear();</span><br><span class="line">        params.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-3-Delete请求"><a href="#2-4-3-Delete请求" class="headerlink" title="2.4.3-Delete请求"></a>2.4.3-Delete请求</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/v1/del&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">del</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        params.clear();</span><br><span class="line">        params.put(<span class="string">&quot;id&quot;</span>, id);</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-5-Jackson使用"><a href="#2-5-Jackson使用" class="headerlink" title="2.5-Jackson使用"></a>2.5-Jackson使用</h3><p><strong>简介：介绍常用json框架和注解的使用，自定义返回json结构和格式</strong></p>
<ul>
<li>常用框架 阿里 fastjson,谷歌gson等</li>
<li>JavaBean序列化为Json，<ul>
<li>性能：Jackson &gt; FastJson &gt; Gson &gt; Json-lib 同个结构</li>
<li>Jackson、FastJson、Gson类库各有优点，各有自己的专长</li>
<li>空间换时间，时间换空间</li>
</ul>
</li>
<li>jackson处理相关自动<ul>
<li>指定字段不返回：@JsonIgnore</li>
<li>指定日期格式：@JsonFormat(pattern=”yyyy-MM-dd hh:mm:ss”,locale=”zh”,timezone=”GMT+8”)</li>
<li>空字段不返回：@JsonInclude(Include.NON_NUll)</li>
<li>指定别名：@JsonProperty</li>
</ul>
</li>
</ul>
<h3 id="2-6-SpringBoot目录文件结构"><a href="#2-6-SpringBoot目录文件结构" class="headerlink" title="2.6-SpringBoot目录文件结构"></a>2.6-SpringBoot目录文件结构</h3><p><strong>简介：讲解SpringBoot目录文件结构和官方推荐的目录规范</strong></p>
<ul>
<li><p>目录讲解</p>
<ul>
<li>src/main/java：存放代码</li>
<li>src/main/resources</li>
<li>static: 存放静态文件，比如 css、js、image, （访问方式 <a target="_blank" rel="noopener" href="http://localhost:8080/js/main.js%EF%BC%89">http://localhost:8080/js/main.js）</a></li>
<li>templates:存放静态页面jsp,html,tpl</li>
<li>config:存放配置文件,application.properties</li>
<li>resources:</li>
</ul>
</li>
<li><p>引入依赖 Thymeleaf</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//注意：如果不引人这个依赖包，html文件应该放在默认加载文件夹里面，</span><br><span class="line">//比如resources、static、public这个几个文件夹，才可以访问</span><br></pre></td></tr></table></figure></li>
<li><p>同个文件的加载顺序,静态资源文件 Spring Boot 默认会挨个从</p>
<ul>
<li>META/resources &gt;</li>
<li>resources &gt;</li>
<li>static &gt;</li>
<li>public</li>
</ul>
<p>里面找是否存在相应的资源，如果有则直接返回。</p>
</li>
<li><p>默认配置</p>
<ul>
<li>官网地址：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-web-applications.html#boot-features-spring-mvc-static-content">https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-web-applications.html#boot-features-spring-mvc-static-content</a></li>
<li>spring.resources.static-locations = classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/</li>
</ul>
</li>
<li><p>静态资源文件存储在CDN</p>
</li>
</ul>
<h3 id="2-7-SpringBoot文件上传实战"><a href="#2-7-SpringBoot文件上传实战" class="headerlink" title="2.7-SpringBoot文件上传实战"></a>2.7-SpringBoot文件上传实战</h3><p><strong>简介：讲解HTML页面文件上传和后端处理实战</strong></p>
<ul>
<li><p>springboot文件上传 MultipartFile file，源自SpringMVC</p>
<ul>
<li>静态页面直接访问：localhost:8080/index.html<ul>
<li>注意点：如果想要直接访问html页面，则需要把html放在springboot默认加载的文件夹下面</li>
</ul>
</li>
<li>MultipartFile 对象的transferTo方法，用于文件保存（效率和操作比原先用FileOutStream方便和高效）</li>
</ul>
<p>访问路径 <a target="_blank" rel="noopener" href="http://localhost:8080/images/39020dbb-9253-41b9-8ff9-403309ff3f19.jpeg">http://localhost:8080/images/39020dbb-9253-41b9-8ff9-403309ff3f19.jpeg</a></p>
</li>
<li><p><img src="https://gitee.com/lemon-cs/images/raw/master/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.jpg" alt="文件上传"></p>
</li>
</ul>
<h3 id="2-8-jar包方式运行web项目文件上传和访问"><a href="#2-8-jar包方式运行web项目文件上传和访问" class="headerlink" title="2.8-jar包方式运行web项目文件上传和访问"></a>2.8-jar包方式运行web项目文件上传和访问</h3><p><strong>简介：讲解SpingBoot2.x使用 java -jar运行方式的图片上传和访问处理</strong></p>
<ul>
<li><p>文件大小配置，启动类里面配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> MultipartConfigElement <span class="title">multipartConfigElement</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">	MultipartConfigFactory factory = <span class="keyword">new</span> MultipartConfigFactory();  </span><br><span class="line">	<span class="comment">//单个文件最大  </span></span><br><span class="line">	factory.setMaxFileSize(<span class="string">&quot;10240KB&quot;</span>); <span class="comment">//KB,MB  </span></span><br><span class="line">	<span class="comment">// 设置总上传数据总大小  </span></span><br><span class="line">	factory.setMaxRequestSize(<span class="string">&quot;1024000KB&quot;</span>);  </span><br><span class="line">	<span class="keyword">return</span> factory.createMultipartConfig();  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></li>
<li><p>打包成jar包，需要增加maven依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果没加相关依赖，执行maven打包，运行后会报错:no main manifest attribute, in XXX.jar</span><br><span class="line">GUI：反编译工具，作用就是用于把class文件转换成java文件</span><br></pre></td></tr></table></figure></li>
<li><p>文件上传和访问需要指定磁盘路径</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">application.properties中增加下面配置</span></span><br><span class="line"><span class="meta">1)</span> <span class="string">web.images-path=/Users/jack/Desktop</span></span><br><span class="line"><span class="meta">2)</span> <span class="string">spring.resources.static-locations=classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/,classpath:/test/,file:$&#123;web.upload-path&#125; </span></span><br></pre></td></tr></table></figure></li>
<li><p>文件服务器：fastdfs，阿里云oss，nginx搭建一个简单的文件服务器等</p>
</li>
</ul>
<h3 id="2-9-构建RESTful-API与单元测试"><a href="#2-9-构建RESTful-API与单元测试" class="headerlink" title="2.9-构建RESTful API与单元测试"></a>2.9-构建RESTful API与单元测试</h3><p>首先，回顾并详细说明一下在<a target="_blank" rel="noopener" href="http://blog.didispace.com/spring-boot-learning-21-1-1/">快速入门</a>中使用的<code>@Controller</code>、<code>@RestController</code>、<code>@RequestMapping</code>注解。如果您对Spring MVC不熟悉并且还没有尝试过快速入门案例，建议先看一下<a target="_blank" rel="noopener" href="http://blog.didispace.com/spring-boot-learning-21-1-1/">快速入门</a>的内容。</p>
<ul>
<li><code>@Controller</code>：修饰class，用来创建处理http请求的对象</li>
<li><code>@RestController</code>：Spring4之后加入的注解，原来在<code>@Controller</code>中返回json需要<code>@ResponseBody</code>来配合，如果直接用<code>@RestController</code>替代<code>@Controller</code>就不需要再配置<code>@ResponseBody</code>，默认返回json格式</li>
<li><code>@RequestMapping</code>：配置url映射。现在更多的也会直接用以Http Method直接关联的映射注解来定义，比如：<code>GetMapping</code>、<code>PostMapping</code>、<code>DeleteMapping</code>、<code>PutMapping</code>等</li>
</ul>
<p>下面我们通过使用Spring MVC来实现一组对User对象操作的RESTful API，配合注释详细说明在Spring MVC中如何映射HTTP请求、如何传参、如何编写单元测试。</p>
<p><strong>RESTful API具体设计如下：</strong></p>
<p>![RESTful API](<a target="_blank" rel="noopener" href="https://gitee.com/lemon-cs/images/raw/master/RESTful">https://gitee.com/lemon-cs/images/raw/master/RESTful</a> API.jpg)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/users&quot;)</span>     <span class="comment">// 通过这里配置使下面的映射都在/users下</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建线程安全的Map，模拟users信息的存储</span></span><br><span class="line">    <span class="keyword">static</span> Map&lt;Long, User&gt; users = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;Long, User&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理&quot;/users/&quot;的GET请求，用来获取用户列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 还可以通过@RequestParam从页面中传递参数来进行查询条件或者翻页信息的传递</span></span><br><span class="line">        List&lt;User&gt; r = <span class="keyword">new</span> ArrayList&lt;User&gt;(users.values());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理&quot;/users/&quot;的POST请求，用来创建User</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">postUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// @RequestBody注解用来绑定通过http请求中application/json类型上传的数据</span></span><br><span class="line">        users.put(user.getId(), user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理&quot;/users/&#123;id&#125;&quot;的GET请求，用来获取url中id值的User信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// url中的id可通过@PathVariable绑定到函数的参数中</span></span><br><span class="line">        <span class="keyword">return</span> users.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理&quot;/users/&#123;id&#125;&quot;的PUT请求，用来更新User信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">putUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        User u = users.get(id);</span><br><span class="line">        u.setName(user.getName());</span><br><span class="line">        u.setAge(user.getAge());</span><br><span class="line">        users.put(id, u);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理&quot;/users/&#123;id&#125;&quot;的DELETE请求，用来删除User</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> </span>&#123;</span><br><span class="line">        users.remove(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>单元测试：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter21ApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mvc = MockMvcBuilders.standaloneSetup(<span class="keyword">new</span> UserController()).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUserController</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 测试UserController</span></span><br><span class="line">        RequestBuilder request;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、get查一下user列表，应该为空</span></span><br><span class="line">        request = get(<span class="string">&quot;/users/&quot;</span>);</span><br><span class="line">        mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(content().string(equalTo(<span class="string">&quot;[]&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、post提交一个user</span></span><br><span class="line">        request = post(<span class="string">&quot;/users/&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .content(<span class="string">&quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;测试大师\&quot;,\&quot;age\&quot;:20&#125;&quot;</span>);</span><br><span class="line">        mvc.perform(request)</span><br><span class="line">                .andExpect(content().string(equalTo(<span class="string">&quot;success&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、get获取user列表，应该有刚才插入的数据</span></span><br><span class="line">        request = get(<span class="string">&quot;/users/&quot;</span>);</span><br><span class="line">        mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(content().string(equalTo(<span class="string">&quot;[&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;测试大师\&quot;,\&quot;age\&quot;:20&#125;]&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、put修改id为1的user</span></span><br><span class="line">        request = put(<span class="string">&quot;/users/1&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .content(<span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;测试终极大师\&quot;,\&quot;age\&quot;:30&#125;&quot;</span>);</span><br><span class="line">        mvc.perform(request)</span><br><span class="line">                .andExpect(content().string(equalTo(<span class="string">&quot;success&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、get一个id为1的user</span></span><br><span class="line">        request = get(<span class="string">&quot;/users/1&quot;</span>);</span><br><span class="line">        mvc.perform(request)</span><br><span class="line">                .andExpect(content().string(equalTo(<span class="string">&quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;测试终极大师\&quot;,\&quot;age\&quot;:30&#125;&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、del删除id为1的user</span></span><br><span class="line">        request = delete(<span class="string">&quot;/users/1&quot;</span>);</span><br><span class="line">        mvc.perform(request)</span><br><span class="line">                .andExpect(content().string(equalTo(<span class="string">&quot;success&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7、get查一下user列表，应该为空</span></span><br><span class="line">        request = get(<span class="string">&quot;/users/&quot;</span>);</span><br><span class="line">        mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(content().string(equalTo(<span class="string">&quot;[]&quot;</span>)));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-10-使用Swagger2构建强大的API文档"><a href="#2-10-使用Swagger2构建强大的API文档" class="headerlink" title="2.10-使用Swagger2构建强大的API文档"></a>2.10-使用Swagger2构建强大的API文档</h3><p>随着前后端分离架构和微服务架构的流行，我们使用Spring Boot来构建RESTful API项目的场景越来越多。通常我们的一个RESTful API就有可能要服务于多个不同的开发人员或开发团队：IOS开发、Android开发、Web开发甚至其他的后端服务等。为了减少与其他团队平时开发期间的频繁沟通成本，传统做法就是创建一份RESTful API文档来记录所有接口细节，然而这样的做法有以下几个问题：</p>
<ul>
<li>由于接口众多，并且细节复杂（需要考虑不同的HTTP请求类型、HTTP头部信息、HTTP请求内容等），高质量地创建这份文档本身就是件非常吃力的事，下游的抱怨声不绝于耳。</li>
<li>随着时间推移，不断修改接口实现的时候都必须同步修改接口文档，而文档与代码又处于两个不同的媒介，除非有严格的管理机制，不然很容易导致不一致现象。</li>
</ul>
<p>为了解决上面这样的问题，本文将介绍RESTful API的重磅好伙伴Swagger2，它可以轻松的整合到Spring Boot中，并与Spring MVC程序配合组织出强大RESTful API文档。它既可以减少我们创建文档的工作量，同时说明内容又整合入实现代码中，让维护文档和修改代码整合为一体，可以让我们在修改代码逻辑的同时方便的修改文档说明。另外Swagger2也提供了强大的页面测试功能来调试每个RESTful API。具体效果如下图所示：</p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/Swagger.jpg" alt="Swagger"></p>
<ol>
<li><p>添加swagger-spring-boot-starter依赖</p>
<p>在<code>pom.xml</code>中加入依赖，具体如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spring4all<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>应用主类中添加<code>@EnableSwagger2Doc</code>注解，具体如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableSwagger2Doc</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chapter22Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Chapter22Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><code>application.properties</code>中配置文档相关内容，比如</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">swagger.title=spring-boot-starter-swagger</span><br><span class="line">swagger.description=Starter for swagger 2.x</span><br><span class="line">swagger.version=1.4.0.RELEASE</span><br><span class="line">swagger.license=Apache License, Version 2.0</span><br><span class="line">swagger.licenseUrl=https://www.apache.org/licenses/LICENSE-2.0.html</span><br><span class="line">swagger.termsOfServiceUrl=https://github.com/dyc87112/spring-boot-starter-swagger</span><br><span class="line">swagger.contact.name=didi</span><br><span class="line">swagger.contact.url=http://blog.didispace.com</span><br><span class="line">swagger.contact.email=dyc87112@qq.com</span><br><span class="line">swagger.base-package=com.didispace</span><br><span class="line">swagger.base-path=/**</span><br></pre></td></tr></table></figure>

<p>各参数配置含义如下：</p>
<ul>
<li><code>swagger.title</code>：标题</li>
<li><code>swagger.description</code>：描述</li>
<li><code>swagger.version</code>：版本</li>
<li><code>swagger.license</code>：许可证</li>
<li><code>swagger.licenseUrl</code>：许可证URL</li>
<li><code>swagger.termsOfServiceUrl</code>：服务条款URL</li>
<li><code>swagger.contact.name</code>：维护人</li>
<li><code>swagger.contact.url</code>：维护人URL</li>
<li><code>swagger.contact.email</code>：维护人email</li>
<li><code>swagger.base-package</code>：swagger扫描的基础包，默认：全扫描</li>
<li><code>swagger.base-path</code>：需要处理的基础URL规则，默认：/**</li>
</ul>
<p>更多配置说明可见官方说明：<a target="_blank" rel="noopener" href="https://github.com/SpringForAll/spring-boot-starter-swagger">https://github.com/SpringForAll/spring-boot-starter-swagger</a></p>
</li>
<li><p>启动应用，访问：<code>http://localhost:8080/swagger-ui.html</code>，就可以看到如下的接口文档页面：</p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/Swagger.jpg" alt="Swagger"></p>
</li>
<li><p><strong>添加文档内容</strong></p>
<p>在整合完Swagger之后，在<code>http://localhost:8080/swagger-ui.html</code>页面中可以看到，关于各个接口的描述还都是英文或遵循代码定义的名称产生的。这些内容对用户并不友好，所以我们需要自己增加一些说明来丰富文档内容。如下所示，我们通过<code>@Api</code>，<code>@ApiOperation</code>注解来给API增加说明、通过<code>@ApiImplicitParam</code>、<code>@ApiModel</code>、<code>@ApiModelProperty</code>注解来给参数增加说明。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;用户管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/users&quot;)</span>     <span class="comment">// 通过这里配置使下面的映射都在/users下</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建线程安全的Map，模拟users信息的存储</span></span><br><span class="line">    <span class="keyword">static</span> Map&lt;Long, User&gt; users = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取用户列表&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; r = <span class="keyword">new</span> ArrayList&lt;&gt;(users.values());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;创建用户&quot;, notes = &quot;根据User对象创建用户&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">postUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        users.put(user.getId(), user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取用户详细信息&quot;, notes = &quot;根据url的id来获取用户详细信息&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> users.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(paramType = &quot;path&quot;, dataType = &quot;Long&quot;, name = &quot;id&quot;, value = &quot;用户编号&quot;, required = true, example = &quot;1&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;更新用户详细信息&quot;, notes = &quot;根据url的id来指定更新对象，并根据传过来的user信息来更新用户详细信息&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">putUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        User u = users.get(id);</span><br><span class="line">        u.setName(user.getName());</span><br><span class="line">        u.setAge(user.getAge());</span><br><span class="line">        users.put(id, u);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除用户&quot;, notes = &quot;根据url的id来指定删除对象&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> </span>&#123;</span><br><span class="line">        users.remove(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description=&quot;用户实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户编号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户年龄&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完成上述代码添加后，启动Spring Boot程序，访问：<code>http://localhost:8080/swagger-ui.html</code>，就能看到下面这样带中文说明的文档了（其中标出了各个注解与文档元素的对应关系以供参考）：</p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/Swagger%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86.jpg" alt="Swagger用户管理"></p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/Swagger%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7.jpg" alt="Swagger更新用户"></p>
</li>
<li><p><strong>API文档访问与调试</strong><br>在上图请求的页面中，我们看到user的Value是个输入框？是的，Swagger除了查看接口功能外，还提供了调试测试功能，我们可以点击上图中右侧的Model Schema（黄色区域：它指明了User的数据结构），此时Value中就有了user对象的模板，我们只需要稍适修改，点击下方“Try it out！”按钮，即可完成了一次请求调用！</p>
<p>此时，你也可以通过几个GET请求来验证之前的POST请求是否正确。</p>
<p>相比为这些接口编写文档的工作，我们增加的配置内容是非常少而且精简的，对于原有代码的侵入也在忍受范围之内。因此，在构建RESTful API的同时，加入Swagger来对API文档进行管理，是个不错的选择。</p>
</li>
</ol>
<h3 id="2-11-JSR-303实现请求参数校验"><a href="#2-11-JSR-303实现请求参数校验" class="headerlink" title="2.11-JSR-303实现请求参数校验"></a>2.11-JSR-303实现请求参数校验</h3><p>请求参数的校验是很多新手开发非常容易犯错，或存在较多改进点的常见场景。比较常见的问题主要表现在以下几个方面：</p>
<ul>
<li>仅依靠前端框架解决参数校验，缺失服务端的校验。这种情况常见于需要同时开发前后端的时候，虽然程序的正常使用不会有问题，但是开发者忽略了非正常操作。比如绕过前端程序，直接模拟客户端请求，这时候就会突然在前端预设的各种限制，直击各种数据访问接口，使得我们的系统存在安全隐患。</li>
<li>大量地使用<code>if/else</code>语句嵌套实现，校验逻辑晦涩难通，不利于长期维护。</li>
</ul>
<p>所以，针对上面的问题，建议服务端开发在实现接口的时候，对于请求参数必须要有服务端校验以保障数据安全与稳定的系统运行。同时，对于参数的校验实现需要足够优雅，要满足逻辑易读、易维护的基本特点。</p>
<p>接下来，我们就在本篇教程中详细说说，如何优雅地实现Spring Boot服务端的请求参数校验。</p>
<h4 id="JSR-303"><a href="#JSR-303" class="headerlink" title="JSR-303"></a>JSR-303</h4><p>在开始动手实践之前，我们先了解一下接下来我们将使用的一项标准规范：JSR-303</p>
<p><strong>什么是JSR？</strong></p>
<p>JSR是Java Specification Requests的缩写，意思是Java 规范提案。是指向JCP(Java Community Process)提出新增一个标准化技术规范的正式请求。任何人都可以提交JSR，以向Java平台增添新的API和服务。JSR已成为Java界的一个重要标准。</p>
<p><strong>JSR-303定义的是什么标准？</strong></p>
<p>JSR-303 是JAVA EE 6 中的一项子规范，叫做Bean Validation，Hibernate Validator 是 Bean Validation 的参考实现 . Hibernate Validator 提供了 JSR 303 规范中所有内置 constraint 的实现，除此之外还有一些附加的 constraint。</p>
<p><strong>Bean Validation中内置的constraint</strong></p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/Bean-Validation.jpg" alt="Bean Validation"></p>
<p><strong>Hibernate Validator附加的constraint</strong></p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/hibernate-Validation.jpg"></p>
<h4 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h4><p>我们先来做一个简单的例子，比如：定义字段不能为<code>Null</code>。只需要两步</p>
<p><strong>第一步</strong>：在要校验的字段上添加上<code>@NotNull</code>注解，具体如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description=&quot;用户实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户编号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户年龄&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>第二步</strong>：在需要校验的参数实体前添加<code>@Valid</code>注解，具体如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;创建用户&quot;, notes = &quot;根据User对象创建用户&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">postUser</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">    users.put(user.getId(), user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完成上面配置之后，启动应用，并用POST请求访问<code>localhost:8080/users/</code>接口，body使用一个空对象，<code>&#123;&#125;</code>。你可以用Postman等测试工具发起，也可以使用curl发起，比如这样：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  http://localhost:8080/users/ \</span><br><span class="line">  -H &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">  -H &#x27;Postman-Token: 72745d04-caa5-44a1-be84-ba9c115f4dfb&#x27; \</span><br><span class="line">  -H &#x27;cache-control: no-cache&#x27; \</span><br><span class="line">  -d &#x27;&#123;</span><br><span class="line">    </span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>不出意外，你可以得到如下结果：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;2019-10-05T05:45:19.221+0000&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;Bad Request&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;errors&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;NotNull.user.age&quot;</span>,</span><br><span class="line">                <span class="string">&quot;NotNull.age&quot;</span>,</span><br><span class="line">                <span class="string">&quot;NotNull.java.lang.Integer&quot;</span>,</span><br><span class="line">                <span class="string">&quot;NotNull&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;arguments&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;user.age&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;age&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;arguments&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;age&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;age&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;不能为null&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;objectName&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;age&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;rejectedValue&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;bindingFailure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;NotNull&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;NotNull.user.name&quot;</span>,</span><br><span class="line">                <span class="string">&quot;NotNull.name&quot;</span>,</span><br><span class="line">                <span class="string">&quot;NotNull.java.lang.String&quot;</span>,</span><br><span class="line">                <span class="string">&quot;NotNull&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;arguments&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;user.name&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;name&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;arguments&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;name&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;不能为null&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;objectName&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;rejectedValue&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;bindingFailure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;NotNull&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Validation failed for object=&#x27;user&#x27;. Error count: 2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/users/&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中返回内容的各参数含义如下：</p>
<ul>
<li><code>timestamp</code>：请求时间</li>
<li><code>status</code>：HTTP返回的状态码，这里返回400，即：请求无效、错误的请求，通常参数校验不通过均为400</li>
<li><code>error</code>：HTTP返回的错误描述，这里对应的就是400状态的错误描述：Bad Request</li>
<li><code>errors</code>：具体错误原因，是一个数组类型；因为错误校验可能存在多个字段的错误，比如这里因为定义了两个参数不能为<code>Null</code>，所以存在两条错误记录信息</li>
<li><code>message</code>：概要错误消息，返回内容中很容易可以知道，这里的错误原因是对user对象的校验失败，其中错误数量为<code>2</code>，而具体的错误信息就定义在上面的<code>errors</code>数组中</li>
<li><code>path</code>：请求路径</li>
</ul>
<p>请求的调用端在拿到这个规范化的错误信息之后，就可以方便的解析并作出对应的措施以完成自己的业务逻辑了。</p>
<h3 id="尝试一些其他校验"><a href="#尝试一些其他校验" class="headerlink" title="尝试一些其他校验"></a>尝试一些其他校验</h3><p>在完成了上面的例子之后，我们还可以增加一些校验规则，比如：校验字符串的长度、校验数字的大小、校验字符串格式是否为邮箱等。下面我们就来定义一些复杂的校验定义，比如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description=&quot;用户实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户编号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Size(min = 2, max = 5)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Max(100)</span></span><br><span class="line">    <span class="meta">@Min(10)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户年龄&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户邮箱&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发起一个可以出发<code>name</code>、<code>age</code>、<code>email</code>都校验不通过的请求，比如下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -X POST \</span><br><span class="line">  http://localhost:8080/users/ \</span><br><span class="line">  -H &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">  -H &#x27;Postman-Token: 114db0f0-bdce-4ba5-baf6-01e5104a68a3&#x27; \</span><br><span class="line">  -H &#x27;cache-control: no-cache&#x27; \</span><br><span class="line">  -d &#x27;&#123;</span><br><span class="line">    &quot;name&quot;: &quot;abcdefg&quot;,</span><br><span class="line">    &quot;age&quot;: 8,</span><br><span class="line">    &quot;email&quot;: &quot;aaaa&quot;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>我们将得到如下的错误返回：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;2019-10-05T06:24:30.518+0000&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;Bad Request&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;errors&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;Size.user.name&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Size.name&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Size.java.lang.String&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Size&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;arguments&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;user.name&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;name&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;arguments&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;name&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="number">5</span>,</span><br><span class="line">                <span class="number">2</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;个数必须在2和5之间&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;objectName&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;rejectedValue&quot;</span>: <span class="string">&quot;abcdefg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;bindingFailure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;Size&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;Min.user.age&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Min.age&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Min.java.lang.Integer&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Min&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;arguments&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;user.age&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;age&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;arguments&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;age&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;age&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="number">10</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;最小不能小于10&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;objectName&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;age&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;rejectedValue&quot;</span>: <span class="number">8</span>,</span><br><span class="line">            <span class="attr">&quot;bindingFailure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;Min&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;Email.user.email&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Email.email&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Email.java.lang.String&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Email&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;arguments&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;user.email&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;email&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;arguments&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">                    <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;email&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;email&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                [],</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;.*&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;codes&quot;</span>: [</span><br><span class="line">                        <span class="string">&quot;.*&quot;</span></span><br><span class="line">                    ],</span><br><span class="line">                    <span class="attr">&quot;arguments&quot;</span>: <span class="literal">null</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;defaultMessage&quot;</span>: <span class="string">&quot;不是一个合法的电子邮件地址&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;objectName&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;email&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;rejectedValue&quot;</span>: <span class="string">&quot;aaaa&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;bindingFailure&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;code&quot;</span>: <span class="string">&quot;Email&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;Validation failed for object=&#x27;user&#x27;. Error count: 3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/users/&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从<code>errors</code>数组中的各个错误明细中，知道各个字段的<code>defaultMessage</code>，可以看到很清晰的错误描述。</p>
<h2 id="3-SpringBoot热部署devtool和配置文件自动注入实战"><a href="#3-SpringBoot热部署devtool和配置文件自动注入实战" class="headerlink" title="3-SpringBoot热部署devtool和配置文件自动注入实战"></a>3-SpringBoot热部署devtool和配置文件自动注入实战</h2><h3 id="3-1-使用Dev-tool热部署"><a href="#3-1-使用Dev-tool热部署" class="headerlink" title="3.1-使用Dev-tool热部署"></a>3.1-使用Dev-tool热部署</h3><p><strong>简介:介绍什么是热部署，使用springboot结合dev-tool工具，快速加载启动应用</strong></p>
<ul>
<li><p>什么是热部署？</p>
<ul>
<li><p>在应用运行的时升级软件，无需重新启动的方式有两种，<code>热部署</code>和<code>热加载</code>。</p>
<p>对于Java应用程序来说，<code>热部署</code>就是在服务器运行时重新部署项目，<code>热加载</code>即在在运行时重新加载class，从而升级应用。</p>
</li>
<li><p><code>热加载</code>的实现原理主要依赖java的类加载机制，在实现方式可以概括为在容器启动的时候起一条后台线程，定时的检测类文件的时间戳变化，如果类的时间戳变掉了，则将类重新载入。</p>
<p>对比反射机制，反射是在运行时获取类信息，通过动态的调用来改变程序行为； 热加载则是在运行时通过重新加载改变类信息，直接改变程序行为。</p>
<p><code>热部署</code>原理类似，但它是直接重新加载整个应用，这种方式会释放内存，比热加载更加干净彻底，但同时也更费时间。</p>
</li>
</ul>
</li>
<li><p>添加依赖</p>
<ul>
<li>```xml<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <optional>true</optional>
</dependency>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- 添加配置</span><br><span class="line"></span><br><span class="line">  - ```properties</span><br><span class="line">    #热部署</span><br><span class="line">    spring.devtools.restart.enabled=true</span><br><span class="line">    spring.devtools.restart.additional-paths=src/main/java</span><br><span class="line">    #关闭缓存，及时刷新</span><br><span class="line">    #spring.thymeleaf.cache=false</span><br><span class="line">    #排除无需热部署目录</span><br><span class="line">    #spring.devtools.restart.exclude=static/**,public/**</span><br><span class="line">    #srping.devtools.restart.exclude=WEB-INF/**</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>IDEA配置</p>
</li>
</ul>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/IDEA%E9%85%8D%E7%BD%AE.jpg"></p>
<ul>
<li><p>不被热部署的文件 :</p>
<p>1、/META-INF/maven, /META-INF/resources, /resources, /static, /public, or /templates </p>
<p>2、指定文件不进行热部署 spring.devtools.restart.exclude=static/** ,public/** </p>
<p>3、手工触发重启 <code>spring.devtools.restart.trigger-file=trigger.txt</code> 改代码不重启，通过一个文本去控制</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#using-boot-devtools-restart-exclude">https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#using-boot-devtools-restart-exclude</a></p>
<p><code>注意点</code>：生产环境不要开启这个功能，如果用java -jar启动，springBoot是不会进行热部署的</p>
</li>
</ul>
<h3 id="3-2-SpringBoot配置文件"><a href="#3-2-SpringBoot配置文件" class="headerlink" title="3.2-SpringBoot配置文件"></a>3.2-SpringBoot配置文件</h3><p><strong>简介：SpringBoot2.x常见的配置文件 xml、yml、properties的区别和使用</strong></p>
<ul>
<li>xml、properties、json、yaml</li>
<li>常见的配置文件 xx.yml, xx.properties，<ul>
<li>1)YAML（Yet Another Markup Language） 写 YAML 要比写 XML 快得多(无需关注标签或引号) 使用空格 Space 缩进表示分层，不同层次之间的缩进可以使用不同的空格数目 注意：key后面的冒号，后面一定要跟一个空格,树状结构 application.properties示例 server.port=8090<br>server.session-timeout=30<br>server.tomcat.max-threads=0<br>server.tomcat.uri-encoding=UTF-8</li>
</ul>
</li>
<li>application.yml示例 server:<br>port: 8090<br>session-timeout: 30<br>tomcat.max-threads: 0<br>tomcat.uri-encoding: UTF-8</li>
<li>默认示例文件仅作为指导。 不要将整个内容复制并粘贴到您的应用程序中，只挑选您需要的属性。</li>
<li>参考：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#common-application-properties">https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#common-application-properties</a></li>
<li>如果需要修改，直接复制对应的配置文件，加到application.properties里面</li>
</ul>
<h3 id="3-3-SpringBoot注解配置文件自动映射到属性和实体类"><a href="#3-3-SpringBoot注解配置文件自动映射到属性和实体类" class="headerlink" title="3.3-SpringBoot注解配置文件自动映射到属性和实体类"></a>3.3-SpringBoot注解配置文件自动映射到属性和实体类</h3><p><strong>简介：讲解使用@value注解配置文件自动映射到属性和实体类</strong></p>
<ul>
<li><p>1、配置文件加载</p>
<ul>
<li><p>方式一</p>
<ul>
<li><p>1、Controller上面配置 </p>
<p><code>@PropertySource(&#123;&quot;classpath:resource.properties&quot;&#125;)</code></p>
</li>
<li><p>2、增加属性</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;test.name&#125;&quot;)</span> </span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>方式二：实体类配置文件</p>
<ul>
<li><p>1、添加 @Component 注解；</p>
</li>
<li><p>2、使用 @PropertySource 注解指定配置文件位置；</p>
</li>
<li><p>3、使用 @ConfigurationProperties 注解，设置相关属性；</p>
</li>
<li><p>4、必须 通过注入IOC对象Resource 进来 ， 才能在类中使用获取的配置文件值。</p>
<p> <code>@Autowired private ServerSettings serverSettings</code>;</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>例子</p>
<p>1.配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@PropertySource(&#123;&quot;classpath:application.properties&quot;&#125;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerSettings</span> </span>&#123;</span><br><span class="line">	<span class="comment">//应用名称</span></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;test.name&#125;&quot;)</span> </span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">//域名地址</span></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;test.domain&#125;&quot;)</span> </span><br><span class="line">	<span class="keyword">private</span> String domain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.配置文件application.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置文件注入</span></span><br><span class="line"><span class="meta">test.name</span>=<span class="string">springboot</span></span><br><span class="line"><span class="meta">test.domain</span>=<span class="string">www.fangpeng.com</span></span><br></pre></td></tr></table></figure>

<p>3.注入测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span> </span><br><span class="line">  <span class="keyword">private</span> ServerSettings serverSettings;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@GetMapping(&quot;/v1/test_properties&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">testProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> serverSettings;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">常见问题：</span><br><span class="line"><span class="number">1</span>、配置文件注入失败，Could not resolve placeholder</span><br><span class="line">解决：根据springboot启动流程，会有自动扫描包没有扫描到相关注解, </span><br><span class="line">默认Spring框架实现会从声明<span class="meta">@ComponentScan</span>所在的类的<span class="keyword">package</span>进行扫描，来自动注入，</span><br><span class="line">因此启动类最好放在根路径下面，或者指定扫描包范围</span><br><span class="line">spring-boot扫描启动类对应的目录和子目录</span><br><span class="line"><span class="number">2</span>、注入bean的方式，属性名称和配置文件里面的key一一对应，就用加<span class="meta">@Value</span> 这个注解</span><br><span class="line">如果不一样，就要加<span class="meta">@value(&quot;$&#123;XXX&#125;&quot;)</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/%E9%85%8D%E7%BD%AE%E6%B5%8B%E8%AF%95.jpg"></p>
<ul>
<li><p>第二种方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;test&quot;)</span> <span class="comment">//配置文件的属性前缀</span></span><br><span class="line"><span class="meta">@PropertySource(value=&quot;classpath:resource.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerSettings</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> String domain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-Springboot单元测试进阶实战和自定义异常处理"><a href="#4-Springboot单元测试进阶实战和自定义异常处理" class="headerlink" title="4-Springboot单元测试进阶实战和自定义异常处理"></a>4-Springboot单元测试进阶实战和自定义异常处理</h2><h3 id="4-1-SpringBootTest单元测试实战"><a href="#4-1-SpringBootTest单元测试实战" class="headerlink" title="4.1-SpringBootTest单元测试实战"></a>4.1-SpringBootTest单元测试实战</h3><p><strong>简介：讲解SpringBoot的单元测试</strong></p>
<p>1、引入相关依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!--springboot程序测试依赖，如果是自动创建项目默认添加--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、编写单元测试用例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(classes = &#123;ApiApplication.class&#125;)</span> <span class="comment">//启动整个springboot工程</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBootTestDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span> <span class="comment">//Test注解标记方法为测试方法，以便构建工具和IDE能够识别并执行它们</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOne</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;test hello 1&quot;</span>);</span><br><span class="line">        assertEquals(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 其他注解</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@BeforeAll</span>——只执行一次，执行的时机是在所有测试和<span class="doctag">@BeforeEach</span>注解方法之前</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@BeforeEach</span>——在每个测试执行之前执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@AfterEach</span>——在每个测试执行之后执行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@AfterAll</span>——只执行一次，执行时机是在所有测试和<span class="doctag">@AfterEach</span>注解方法之后</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBeforeAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testBefore&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAfterAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testAfter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、Junit5断言</p>
<ul>
<li><strong>assertAll</strong>：断言所有提供的可执行文件都不会抛出异常。若提供的标题(heading),其将包含在MultipleFailuresError的消息字符串中。</li>
<li><strong>assertArrayEquals</strong>：断言期望的和实际的XX类型数组是相等的。若失败，将显示提供的失败消息。</li>
<li><strong>assertDoesNotThrow</strong>：虽然从测试方法抛出的任何异常都会导致测试失败，但在某些用例中，显式断言测试方法中的给定代码块不会抛出异常会很有用。若提供的标题(heading),其将包含在MultipleFailuresError的消息字符串中。</li>
<li><strong>assertEquals</strong>：断言预期和实际是相等的。如有必要，将从提供的messageSupplier中懒惰地检索失败消息。</li>
<li><strong>assertFalse</strong>：断言提供的条件不是真。失败并显示提供的失败消息。</li>
<li><strong>assertIterableEquals</strong>：断言预期和实际的迭代是完全相同的。类似于检查assertArrayEquals(Object []，Object []，String)中的完全相等，如果遇到两个迭代(包括期望和实际)，则它们的迭代器必须以相同的顺序返回相等的元素。注意：这意味着迭代器不需要是同一类型。</li>
<li><strong>assertNotNull</strong>：断言提供的条件不为null。</li>
<li><strong>assertNotSame</strong>：断言预期和实际不会引用同一个对象。</li>
<li><strong>assertNull</strong>：断言提供的实际为null。</li>
<li><strong>assertSame</strong>：断言预期和实际引用同一个对象。</li>
<li><strong>assertThrows</strong>：断言所提供的可执行代码块的执行会引发expectedType的异常并返回异常。如果没有抛出异常，或者抛出了不同类型的异常，则此方法将失败。如果不想对异常实例执行其他检查，只需忽略返回值。</li>
<li><strong>assertTimeout</strong>：断言在超出给定超时之前，所提供的可执行代码块的执行完成。注意：可执行代码块将在与调用代码相同的线程中执行。因此，如果超过超时，则不会抢先中止执行可执行代码块。</li>
<li><strong>assertTimeoutPreemptively</strong>：断言在超出给定超时之前，所提供的可执行代码块的执行完成。注意：可执行代码块将在与调用代码不同的线程中执行。此外，如果超过超时，则可抢占地执行可执行代码块。</li>
<li><strong>assertTrue</strong>：断言提供的条件为true。</li>
<li><strong>fail</strong>：使用给定的失败消息以及根本原因进行测试失败。泛型返回类型V允许此方法直接用作单语句lambda表达式，从而避免需要实现具有显式返回值的代码块。 由于此方法在其return语句之前抛出AssertionFailedError，因此该方法实际上永远不会向其调用者返回值。</li>
</ul>
<h3 id="4-2-SpringBoot测试之MockMvc讲解"><a href="#4-2-SpringBoot测试之MockMvc讲解" class="headerlink" title="4.2-SpringBoot测试之MockMvc讲解"></a>4.2-SpringBoot测试之MockMvc讲解</h3><p><strong>简介: 讲解MockMvc类的使用和模拟Http请求实战</strong></p>
<ul>
<li>增加类注解 <code>@AutoConfigureMockMvc</code> 和 <code>@SpringBootTest</code></li>
<li>相关API <ul>
<li>perform：执行一个RequestBuilder请求 </li>
<li>andExpect：添加ResultMatcher-&gt;MockMvcResultMatchers验证规则 andReturn：最后返回相应的MvcResult-&gt;Response</li>
<li>andReturn：最后返回相应的MvcResult-&gt;Response</li>
</ul>
</li>
</ul>
<h4 id="4-2-1-什么是Mock？"><a href="#4-2-1-什么是Mock？" class="headerlink" title="4.2.1-什么是Mock？"></a>4.2.1-什么是Mock？</h4><p>在面向对象的程序设计中，模拟对象（英语：<code>mock object</code>）是以可控的方式模拟真实对象行为的假对象。在编程过程中，通常通过模拟一些输入数据，来验证程序是否达到预期结果。</p>
<h4 id="4-2-2-为什么使用Mock对象？"><a href="#4-2-2-为什么使用Mock对象？" class="headerlink" title="4.2.2-为什么使用Mock对象？"></a>4.2.2-为什么使用Mock对象？</h4><p>使用模拟对象，可以模拟复杂的、真实的对象行为。如果在单元测试中无法使用真实对象，可采用模拟对象进行替代。</p>
<p><strong>在以下情况可以采用模拟对象来替代真实对象：</strong></p>
<ul>
<li>真实对象的行为是不确定的（例如，当前的时间或温度）；</li>
<li>真实对象很难搭建起来；</li>
<li>真实对象的行为很难触发（例如，网络错误）；</li>
<li>真实对象速度很慢（例如，一个完整的数据库，在测试之前可能需要初始化）；</li>
<li>真实的对象是用户界面，或包括用户界面在内；</li>
<li>真实的对象使用了回调机制；</li>
<li>真实对象可能还不存在；</li>
<li>真实对象可能包含不能用作测试（而不是为实际工作）的信息和方法。</li>
</ul>
<p><strong>注：使用Mockito一般分三个步骤：</strong></p>
<ol>
<li>模拟测试类所需的外部依赖；</li>
<li>执行测试代码；</li>
<li>判断执行结果是否达到预期；</li>
</ol>
<h4 id="4-2-3-MockMvc"><a href="#4-2-3-MockMvc" class="headerlink" title="4.2.3-MockMvc"></a>4.2.3-MockMvc</h4><p><code>MockMvc</code>是由spring-test包提供，实现了对Http请求的模拟，能够直接使用网络的形式，转换到Controller的调用，使得测试速度快、不依赖网络环境。同时提供了一套验证的工具，结果的验证十分方便。</p>
<p><strong>接口<code>MockMvcBuilder</code>，提供一个唯一的<code>build</code>方法，用来构造MockMvc。</strong></p>
<p>主要有两个实现：<code>StandaloneMockMvcBuilder</code>和<code>DefaultMockMvcBuilder</code>，分别对应两种测试方式，即独立安装和集成Web环境测试（并不会集成真正的web环境，而是通过相应的Mock API进行模拟测试，无须启动服务器）。MockMvcBuilders提供了对应的创建方法standaloneSetup方法和webAppContextSetup方法，在使用时直接调用即可。</p>
<h4 id="4-2-4-在SpringBoot中使用"><a href="#4-2-4-在SpringBoot中使用" class="headerlink" title="4.2.4-在SpringBoot中使用"></a>4.2.4-在SpringBoot中使用</h4><ol>
<li>引入依赖（jar包），创建SpringBoot项目中默认引入的spring-boot-starter-test间接引入了spring-test，因此无需再额外引入jar包。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建Controller类并编写相关方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//测试MockMvc</span></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/test/mockmvc&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testMock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test_mockmvc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>编写测试类。实例化MockMvc有两种形式，一种是使用StandaloneMockMvcBuilder，另外一种是使用DefaultMockMvcBuilder。</p>
<ul>
<li><p>测试类及初始化MockMvc初始化：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> WebApplicationContext webApplicationContext;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 实例化方式一</span></span><br><span class="line">		mockMvc = MockMvcBuilders.standaloneSetup(<span class="keyword">new</span> HelloWorldController()).build();</span><br><span class="line">		<span class="comment">// 实例化方式二</span></span><br><span class="line"><span class="comment">//		mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>单元测试方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(classes = &#123;ApiApplication.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockMvcTestDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apiTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MvcResult mvcResult = mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">&quot;/test/mockmvc&quot;</span>))</span><br><span class="line">                .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();</span><br><span class="line">        <span class="keyword">int</span> status = mvcResult.getResponse().getStatus();</span><br><span class="line">        System.out.println(status);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHello</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 1、mockMvc.perform执行一个请求。</span></span><br><span class="line"><span class="comment">         * 2、MockMvcRequestBuilders.get(&quot;XXX&quot;)构造一个请求。</span></span><br><span class="line"><span class="comment">         * 3、ResultActions.param添加请求传值</span></span><br><span class="line"><span class="comment">         * 4、ResultActions.accept(MediaType.TEXT_HTML_VALUE))设置返回类型</span></span><br><span class="line"><span class="comment">         * 5、ResultActions.andExpect添加执行完成后的断言。</span></span><br><span class="line"><span class="comment">         * 6、ResultActions.andDo添加一个结果处理器，表示要对结果做点什么事情</span></span><br><span class="line"><span class="comment">         *   比如此处使用MockMvcResultHandlers.print()输出整个响应结果信息。</span></span><br><span class="line"><span class="comment">         * 7、ResultActions.andReturn表示执行完成后返回相应的结果。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        mockMvc.perform(MockMvcRequestBuilders</span><br><span class="line">                .get(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置返回值类型为utf-8，否则默认为ISO-8859-1</span></span><br><span class="line">                .accept(MediaType.APPLICATION_JSON_UTF8_VALUE)</span><br><span class="line">                .param(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Tom&quot;</span>))</span><br><span class="line">                .andExpect(MockMvcResultMatchers.status().isOk())</span><br><span class="line">                .andExpect(MockMvcResultMatchers.content().string(<span class="string">&quot;Hello Tom!&quot;</span>))</span><br><span class="line">                .andDo(MockMvcResultHandlers.print());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="4-3-SpringBoot个性化启动banner设置和debug日志"><a href="#4-3-SpringBoot个性化启动banner设置和debug日志" class="headerlink" title="4.3-SpringBoot个性化启动banner设置和debug日志"></a>4.3-SpringBoot个性化启动banner设置和debug日志</h3><p><strong>简介：自定义应用启动的趣味性日志图标和查看调试日志</strong></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">1、启动获取更多信息</span> <span class="string">java -jar xxx.jar --debug</span></span><br><span class="line">	</span><br><span class="line"><span class="attr">2、修改启动的banner信息</span></span><br><span class="line">		<span class="attr">1）在类路径下增加一个banner.txt，里面是启动要输出的信息</span></span><br><span class="line">		<span class="meta">2）在applicatoin.properties增加banner文件的路径地址</span> <span class="string"></span></span><br><span class="line">			<span class="meta">spring.banner.location</span>=<span class="string">banner.txt</span></span><br><span class="line"></span><br><span class="line">		<span class="meta">3）官网地址</span> <span class="string">https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#boot-features-banners</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>输出denbug日志</p>
<ol>
<li><p>修改application.properties配置文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">logging.level.root</span>=<span class="string">debug</span></span><br><span class="line"><span class="meta">或者</span> <span class="string">指定路径</span></span><br><span class="line"><span class="meta">logging.level.com.XXX.XXX.mapper</span>=<span class="string">debug</span></span><br></pre></td></tr></table></figure></li>
<li><p>修改logback-spring.xml配置文件</p>
<p>增加<code>&lt;logger name=&quot;com.XXX.XXX.mapper&quot; level=&quot;DEBUG&quot;&gt;&lt;/logger&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义日志文件的存储地址 勿在 LogBack 的配置中使用相对路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/test/log&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 控制台输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 按照每天生成日志文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件输出的文件名--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/TestWeb.log.%d&#123;yyyy-MM-dd&#125;.log<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件最大的大小--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">triggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>10MB<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">triggeringPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- show parameters for hibernate sql 专为 Hibernate 定制 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.hibernate.type.descriptor.sql.BasicBinder&quot;</span>  <span class="attr">level</span>=<span class="string">&quot;TRACE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.hibernate.type.descriptor.sql.BasicExtractor&quot;</span>  <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.hibernate.SQL&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.hibernate.engine.QueryParameters&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.hibernate.engine.query.HQLQueryPlan&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!--myibatis log configure--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.apache.ibatis&quot;</span> <span class="attr">level</span>=<span class="string">&quot;TRACE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql.Connection&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql.Statement&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql.PreparedStatement&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 日志输出级别 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="4-4-SpringBoot配置全局异常"><a href="#4-4-SpringBoot配置全局异常" class="headerlink" title="4.4-SpringBoot配置全局异常"></a>4.4-SpringBoot配置全局异常</h3><h4 id="4-4-1-模拟全局异常"><a href="#4-4-1-模拟全局异常" class="headerlink" title="4.4.1-模拟全局异常"></a>4.4.1-模拟全局异常</h4><ol>
<li><p>编写异常代码段</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/api/v1/test_ext&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;11&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="number">18</span>, <span class="keyword">new</span> Date());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>返回结果如下</p>
</li>
</ol>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8.jpg"></p>
<h4 id="4-4-2-异常注解介绍"><a href="#4-4-2-异常注解介绍" class="headerlink" title="4.4.2-异常注解介绍"></a>4.4.2-异常注解介绍</h4><p><code>@ControllerAdvice</code> 顾名思义，这是一个增强的 Controller。需要配合@ExceptionHandler使用，<br>当将异常抛到controller时,可以对异常进行统一处理,规定返回的json格式或是跳转到一个错误页面。</p>
<p>使用这个 Controller ，可以实现三个方面的功能：</p>
<ol>
<li>全局异常处理</li>
<li>全局数据绑定</li>
<li>全局数据预处理</li>
</ol>
<p>如果是返回json数据 则用 <code>RestControllerAdvice</code>,就可以不加 @ResponseBody</p>
<p>//捕获全局异常,处理所有不可知的异常<br><code>@ExceptionHandler(value=Exception.class)</code>注解用来指明异常的处理类型</p>
<h4 id="4-4-3-处理全局异常"><a href="#4-4-3-处理全局异常" class="headerlink" title="4.4.3-处理全局异常"></a>4.4.3-处理全局异常</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(CustomExceptionHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//捕获全局异常，处理所有不可知的异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">handleException</span><span class="params">(Exception e, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        LOGGER.error(<span class="string">&quot;url &#123;&#125;, msg &#123;&#125;&quot;</span>,request.getRequestURL(), e.getMessage());</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>, <span class="number">100</span>);</span><br><span class="line">        map.put(<span class="string">&quot;msg&quot;</span>, e.getMessage());</span><br><span class="line">        map.put(<span class="string">&quot;url&quot;</span>, request.getRequestURL());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回结果如下：</strong></p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/%E5%A4%84%E7%90%86%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8.jpg"></p>
<h4 id="4-4-4-处理自定义异常"><a href="#4-4-4-处理自定义异常" class="headerlink" title="4.4.4-处理自定义异常"></a>4.4.4-处理自定义异常</h4><ol>
<li><p>自定义异常类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自定义异常类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(String code, String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>处理自定义异常</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//处理自定义异常</span></span><br><span class="line">   <span class="meta">@ExceptionHandler(value = MyException.class)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">handleMyException</span><span class="params">(MyException e, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">       Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">       map.put(<span class="string">&quot;code&quot;</span>, <span class="number">100</span>);</span><br><span class="line">       map.put(<span class="string">&quot;msg&quot;</span>, e.getMsg());</span><br><span class="line">       map.put(<span class="string">&quot;url&quot;</span>, request.getRequestURL());</span><br><span class="line">       <span class="keyword">return</span> map;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>返回自定义页面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//处理自定义异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MyException.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">handleMyExceptio</span><span class="params">(Exception e, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;error.html&quot;</span>);</span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;msg&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>  <img src="https://gitee.com/lemon-cs/images/raw/master/%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2.jpg"></p>
<h2 id="5-SpringBoot部署war项目到tomcat9和启动原理"><a href="#5-SpringBoot部署war项目到tomcat9和启动原理" class="headerlink" title="5-SpringBoot部署war项目到tomcat9和启动原理"></a>5-SpringBoot部署war项目到tomcat9和启动原理</h2><h3 id="5-1-SpringBoot启动方式和部署war项目到tomcat9"><a href="#5-1-SpringBoot启动方式和部署war项目到tomcat9" class="headerlink" title="5.1-SpringBoot启动方式和部署war项目到tomcat9"></a>5.1-SpringBoot启动方式和部署war项目到tomcat9</h3><ol>
<li><p>IDE启动</p>
</li>
<li><p>jar包方式启动</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">//maven插件:</span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果没有加，则执行jar包 ，报错如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -jar spring-boot-demo-<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT.jar</span><br><span class="line">				no main manifest attribute, in spring-boot-demo-<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>jar包项目结构</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">example.jar</span><br><span class="line">				 |</span><br><span class="line">				 +-META-INF</span><br><span class="line">				 |  +-MANIFEST.MF</span><br><span class="line">				 +-org</span><br><span class="line">				 |  +-springframework</span><br><span class="line">				 |     +-boot</span><br><span class="line">				 |        +-loader</span><br><span class="line">				 |           +-<span class="tag">&lt;<span class="name">spring</span> <span class="attr">boot</span> <span class="attr">loader</span> <span class="attr">classes</span>&gt;</span></span><br><span class="line">				 +-BOOT-INF</span><br><span class="line">				    +-classes</span><br><span class="line">				    |  +-mycompany</span><br><span class="line">				    |     +-project</span><br><span class="line">				    |        +-YourClasses.class</span><br><span class="line">				    +-lib</span><br><span class="line">				       +-dependency1.jar</span><br><span class="line">				       +-dependency2.jar</span><br></pre></td></tr></table></figure>

<p>目录结构讲解<br><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#executable-jar-jar-file-structure">https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#executable-jar-jar-file-structure</a></p>
</li>
<li><p>war包方式启动</p>
<ul>
<li><p>在pom.xml中将打包形式 <code>jar</code> 修改为<code>war</code>  <packaging>war</packaging></p>
<p>构建项目名称 <finalName>springboot_demo</finalName></p>
</li>
<li><p>tocmat下载和安装 <a target="_blank" rel="noopener" href="https://tomcat.apache.org/download-90.cgi">https://tomcat.apache.org/download-90.cgi</a></p>
</li>
<li><p>修改启动类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> <span class="keyword">extends</span> <span class="title">SpringBootServletInitializer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		    <span class="meta">@Override</span></span><br><span class="line">		    <span class="function"><span class="keyword">protected</span> SpringApplicationBuilder <span class="title">configure</span><span class="params">(SpringApplicationBuilder application)</span> </span>&#123;</span><br><span class="line">		        <span class="keyword">return</span> application.sources(DemoApplication.class);</span><br><span class="line">		    &#125;</span><br><span class="line"></span><br><span class="line">		    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">		    &#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>打包项目，启动tomcat</p>
</li>
</ul>
</li>
</ol>
<h3 id="5-2-SpringBoot启动原理"><a href="#5-2-SpringBoot启动原理" class="headerlink" title="5.2-SpringBoot启动原理"></a>5.2-SpringBoot启动原理</h3><h2 id="6-SpringBoot拦截器和-Servlet3-0自定义Filter、Listener"><a href="#6-SpringBoot拦截器和-Servlet3-0自定义Filter、Listener" class="headerlink" title="6-SpringBoot拦截器和 Servlet3.0自定义Filter、Listener"></a>6-SpringBoot拦截器和 Servlet3.0自定义Filter、Listener</h2><h3 id="6-1-SpringBoot过滤器和Servlet3-0配置过滤器"><a href="#6-1-SpringBoot过滤器和Servlet3-0配置过滤器" class="headerlink" title="6.1-SpringBoot过滤器和Servlet3.0配置过滤器"></a>6.1-SpringBoot过滤器和Servlet3.0配置过滤器</h3><ol>
<li>SpringBoot启动默认加载的Filter </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">characterEncodingFilter</span><br><span class="line">hiddenHttpMethodFilter</span><br><span class="line">httpPutFormContentFilter</span><br><span class="line">requestContextFilter</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Filter优先级</li>
</ol>
<p><code>Ordered.HIGHEST_PRECEDENCE</code><br><code>Ordered.LOWEST_PRECEDENCE</code></p>
<p>低位值意味着更高的优先级 Higher values are interpreted as lower priority<br>自定义Filter，避免和默认的Filter优先级一样，不然会冲突</p>
<p>注册Filter的bean FilterRegistrationBean<br>同模块里面有相关默认Filter<br>            web-&gt;servlet-&gt;filter</p>
<ol start="3">
<li>自定义Filter<ul>
<li>使用Servlet3.0的注解进行配置</li>
<li>启动类里面增加 @ServletComponentScan，进行扫描</li>
<li>新建一个Filter类，implements Filter，并实现对应的接口</li>
<li><code>@WebFilter</code> 标记一个类为filter，被spring进行扫描<br> <code>urlPatterns</code>：拦截规则，支持正则</li>
<li>控制chain.doFilter的方法的调用，来实现是否通过放行<br>不放行，web应用resp.sendRedirect(“/index.html”);<br>场景：权限控制、用户登录(非前端后端分离场景)等</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/api/*&quot;, filterName = &quot;loginFilter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//容器加载的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init loginFilter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求被拦截的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;doFilter loginFilter&quot;</span>);</span><br><span class="line"></span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) servletResponse;</span><br><span class="line">        String username = request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;fangpeng&quot;</span>.equals(username)) &#123;</span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//容器被销毁的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy loginFilter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-2-Servlet3-0注解自定义原生Servlet"><a href="#6-2-Servlet3-0注解自定义原生Servlet" class="headerlink" title="6.2-Servlet3.0注解自定义原生Servlet"></a>6.2-Servlet3.0注解自定义原生Servlet</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(name = &quot;userServlet&quot;,urlPatterns = &quot;/test/customs&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">			 <span class="meta">@Override</span></span><br><span class="line">		   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		         resp.getWriter().print(<span class="string">&quot;custom sevlet&quot;</span>);</span><br><span class="line">		         resp.getWriter().flush();</span><br><span class="line">		         resp.getWriter().close();</span><br><span class="line">		     &#125;</span><br><span class="line"></span><br><span class="line">		    <span class="meta">@Override</span></span><br><span class="line">		    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		         <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">		     &#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-3-自定义监听器Listener"><a href="#6-3-自定义监听器Listener" class="headerlink" title="6.3-自定义监听器Listener"></a>6.3-自定义监听器Listener</h3><ul>
<li><p>常用的监听器</p>
<p><code>servletContextListener</code>、<code>httpSessionListener</code>、<code>servletRequestListener</code></p>
</li>
<li><p>Servlet注解自定义监听器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line">		<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestListener</span> <span class="keyword">implements</span> <span class="title">ServletRequestListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestDestroyed</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">			System.out.println(<span class="string">&quot;======requestDestroyed========&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestInitialized</span><span class="params">(ServletRequestEvent sre)</span> </span>&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;======requestInitialized========&quot;</span>);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomContextListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;======contextInitialized======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;contextDestroyed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="6-4-自定义拦截器Interceptor"><a href="#6-4-自定义拦截器Interceptor" class="headerlink" title="6.4-自定义拦截器Interceptor"></a>6.4-自定义拦截器Interceptor</h3><ol>
<li><p>@Configuration</p>
<ul>
<li>继承WebMvcConfigurationAdapter(SpringBoot2.X之前旧版本)</li>
<li>SpringBoot2.X 新版本配置拦截器 implements <code>WebMvcConfigurer</code></li>
</ul>
</li>
<li><p>自定义拦截器 HandlerInterceptor</p>
<ul>
<li>preHandle：调用Controller某个方法之前</li>
<li>postHandle：Controller之后调用，视图渲染之前，如果控制器Controller出现了异常，则不会执行此方法</li>
<li>afterCompletion：不管有没有异常，这个afterCompletion都会被调用，用于资源清理</li>
</ul>
</li>
<li><p>按照注册顺序进行拦截，先注册，先被拦截</p>
</li>
<li><p>拦截器不生效常见问题：</p>
<ul>
<li>是否有加@Configuration</li>
<li>拦截路径是否有问题 <code>**</code>  和 <code>*</code> </li>
<li>拦截器最后路径一定要 “/**”， 如果是目录的话则是 ”/ */“</li>
</ul>
</li>
<li><p>Filter</p>
<p>是基于函数回调 doFilter()，而Interceptor则是基于AOP思想<br>Filter在只在Servlet前后起作用，而Interceptor够深入到方法前后、异常抛出前后等</p>
<p>依赖于Servlet容器即web应用中，而Interceptor不依赖于Servlet容器所以可以运行在多种环境。</p>
<p>在接口调用的生命周期里，Interceptor可以被多次调用，而Filter只能在容器初始化时调用一次。</p>
<p>Filter和Interceptor的执行顺序：</p>
<p>过滤前-&gt;拦截前-&gt;action执行-&gt;拦截后-&gt;过滤后</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进入controller方法之前</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;LoginInterceptor=====&gt;preHandle&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> HandlerInterceptor.<span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用完controller之后，试图渲染之前</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;LoginInterceptor====&gt;postHandle&quot;</span>);</span><br><span class="line">        HandlerInterceptor.<span class="keyword">super</span>.postHandle(request, response, handler, modelAndView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;LoginInterceptor====&gt;afterCompletion&quot;</span>);</span><br><span class="line">        HandlerInterceptor.<span class="keyword">super</span>.afterCompletion(request, response, handler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomWebMvcConfigure</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> LoginInterceptor()).addPathPatterns(<span class="string">&quot;/api/*/**&quot;</span>);</span><br><span class="line">        <span class="comment">//.excludePathPatterns(&quot;/api/*/**&quot;) =====&gt; 排除某路径不被拦截</span></span><br><span class="line">        <span class="comment">//拦截全部 /*/*/**</span></span><br><span class="line">        WebMvcConfigurer.<span class="keyword">super</span>.addInterceptors(registry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="7-数据库操作之整合Mybatis和事务"><a href="#7-数据库操作之整合Mybatis和事务" class="headerlink" title="7-数据库操作之整合Mybatis和事务"></a>7-数据库操作之整合Mybatis和事务</h2><h3 id="7-1-SpringBoot持久化数据方式"><a href="#7-1-SpringBoot持久化数据方式" class="headerlink" title="7.1-SpringBoot持久化数据方式"></a>7.1-SpringBoot持久化数据方式</h3><ol>
<li><p>原始java访问数据库JDBC（开发流程会很麻烦）</p>
<ul>
<li><p>注册驱动/加载驱动——<code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;)</code></p>
</li>
<li><p>建立连接</p>
<p><code>Connection con = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/dbname&quot;,&quot;root&quot;,&quot;root&quot;);</code></p>
</li>
<li><p>创建Statement</p>
</li>
<li><p>执行SQL语句</p>
</li>
<li><p>处理结果集</p>
</li>
<li><p>关闭连接，释放资源</p>
</li>
</ul>
</li>
<li><p>apache dbutils框架</p>
<p>比JDBC简单点<br>官网:<a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-dbutils/">https://commons.apache.org/proper/commons-dbutils/</a></p>
</li>
<li><p>jpa框架</p>
<p><code>spring-data-jpa</code><br>jpa在复杂查询的时候性能不是很好</p>
</li>
<li><p>Hiberante </p>
<p>解释：ORM：对象关系映射Object Relational Mapping<br>企业大都喜欢使用hibernate</p>
</li>
<li><p>Mybatis框架</p>
<p>互联网行业通常使用mybatis<br>不提供对象和关系模型的直接映射,半ORM</p>
</li>
</ol>
<h3 id="7-2-SpringBoot2-x整合Mybatis3-x注解实战"><a href="#7-2-SpringBoot2-x整合Mybatis3-x注解实战" class="headerlink" title="7.2-SpringBoot2.x整合Mybatis3.x注解实战"></a>7.2-SpringBoot2.x整合Mybatis3.x注解实战</h3><ol>
<li><p>使用starter, maven仓库地址：<a target="_blank" rel="noopener" href="http://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter">http://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter</a></p>
</li>
<li><p>加入依赖(可以用 <a target="_blank" rel="noopener" href="http://start.spring.io/">http://start.spring.io/</a> 下载)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入starter--&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">				    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>			    </span><br><span class="line">				<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	 			</span><br><span class="line">	 	<span class="comment">&lt;!-- MySQL的JDBC驱动包	--&gt;</span>	</span><br><span class="line">	 			<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line">		<span class="comment">&lt;!-- 引入第三方数据源 --&gt;</span>		</span><br><span class="line">				<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>加入配置文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#mybatis.type-aliases-package=com.fangpeng.base_project.domain</span></span><br><span class="line"><span class="comment">#可以自动识别</span></span><br><span class="line"><span class="comment">#spring.datasource.driver-class-name =com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/spring?useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">password</span></span><br><span class="line"><span class="comment">#如果不使用默认的数据源 （com.zaxxer.hikari.HikariDataSource）</span></span><br><span class="line"><span class="meta">spring.datasource.type</span> =<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure>

<p>加载配置，注入到<code>sqlSessionFactory</code>等都是springBoot帮我们完成</p>
</li>
<li><p>启动类增加mapper扫描</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.fangpeng.base_project.mapper&quot;)</span></span><br><span class="line"></span><br><span class="line">技巧：保存对象，获取数据库自增id </span><br><span class="line"><span class="meta">@Options(useGeneratedKeys=true, keyProperty=&quot;id&quot;, keyColumn=&quot;id&quot;)</span></span><br></pre></td></tr></table></figure></li>
<li><p>开发mapper<br>参考语法 <a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/zh/java-api.html">http://www.mybatis.org/mybatis-3/zh/java-api.html</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//推荐使用#&#123;&#125;取值，不要用$&#123;&#125;取值，因为存在SQL注入风险</span></span><br><span class="line">    <span class="meta">@Insert(&quot;INSERT INTO user(name,phone,create_time,age) VALUES(#&#123;name&#125;, #&#123;phone&#125;, #&#123;createTime&#125;, #&#123;age&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;, keyColumn = &quot;id&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>开发service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        <span class="keyword">int</span> id = user.getId();</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>开发controller</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setAge(<span class="number">24</span>);</span><br><span class="line">        user.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setName(<span class="string">&quot;kobe&quot;</span>);</span><br><span class="line">        user.setPhone(<span class="string">&quot;10086&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> id = userService.add(user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JsonData.buildSuccess(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>sql脚本</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">		  `id` <span class="type">int</span>(<span class="number">11</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">		  `name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">		  `phone` <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户手机号&#x27;</span>,</span><br><span class="line">		  `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">		  `age` <span class="type">int</span>(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">		  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">		) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">18</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<p><strong>相关资料：</strong></p>
<pre><code>http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/#Configuration
</code></pre>
<p>​    <a target="_blank" rel="noopener" href="https://github.com/mybatis/spring-boot-starter/tree/master/mybatis-spring-boot-samples">https://github.com/mybatis/spring-boot-starter/tree/master/mybatis-spring-boot-samples</a></p>
<p><strong>整合问题集合：</strong></p>
<p>​    <a target="_blank" rel="noopener" href="https://my.oschina.net/hxflar1314520/blog/1800035">https://my.oschina.net/hxflar1314520/blog/1800035</a><br>​    <a target="_blank" rel="noopener" href="https://blog.csdn.net/tingxuetage/article/details/80179772">https://blog.csdn.net/tingxuetage/article/details/80179772</a></p>
</li>
</ol>
<h3 id="7-3-SpringBoot整合Mybatis实操和打印SQL语句"><a href="#7-3-SpringBoot整合Mybatis实操和打印SQL语句" class="headerlink" title="7.3-SpringBoot整合Mybatis实操和打印SQL语句"></a>7.3-SpringBoot整合Mybatis实操和打印SQL语句</h3><ol>
<li><p>控制台打印sql语句        </p>
<pre><code>#增加打印sql语句，一般用于本地开发测试
   `mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl`
</code></pre>
</li>
<li><p>增加mapper代码    </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;SELECT * FROM user&quot;)</span></span><br><span class="line">  <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">      @Result(column = &quot;create_time&quot;,property = &quot;createTime&quot;)  </span></span><br><span class="line"><span class="meta">    //javaType = java.util.Date.class        </span></span><br><span class="line"><span class="meta">  &#125;)</span></span><br><span class="line">  <span class="function">List&lt;User&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Select(&quot;SELECT * FROM user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">  	 @Result(column = &quot;create_time&quot;,property = &quot;createTime&quot;)</span></span><br><span class="line"><span class="meta">  &#125;)</span></span><br><span class="line">  <span class="function">User <span class="title">findById</span><span class="params">(Long id)</span></span>;</span><br><span class="line">   </span><br><span class="line">  <span class="meta">@Update(&quot;UPDATE user SET name=#&#123;name&#125; WHERE id =#&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>;</span><br><span class="line">   </span><br><span class="line">  <span class="meta">@Delete(&quot;DELETE FROM user WHERE id =#&#123;userId&#125;&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long userId)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li><p>增加API</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;find_all&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">findAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> JsonData.buildSuccess(userMapper.getAll());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;find_by_Id&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">findById</span><span class="params">(<span class="keyword">long</span> id)</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> JsonData.buildSuccess(userMapper.findById(id));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;del_by_id&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">delById</span><span class="params">(<span class="keyword">long</span> id)</span></span>&#123;</span><br><span class="line">	userMapper.delete(id);</span><br><span class="line">       <span class="keyword">return</span> JsonData.buildSuccess();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@GetMapping(&quot;update&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">update</span><span class="params">(String name,<span class="keyword">int</span> id)</span></span>&#123;</span><br><span class="line">		User user = <span class="keyword">new</span> User();</span><br><span class="line">		user.setName(name);</span><br><span class="line">		user.setId(id);</span><br><span class="line">		userMapper.update(user);</span><br><span class="line">	    <span class="keyword">return</span> JsonData.buildSuccess();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="7-4-事务介绍和常见的隔离级别，传播行为"><a href="#7-4-事务介绍和常见的隔离级别，传播行为" class="headerlink" title="7.4-事务介绍和常见的隔离级别，传播行为"></a>7.4-事务介绍和常见的隔离级别，传播行为</h3><ol>
<li><p>什么是事务？</p>
<p>指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。<br>简单的说，事务就是并发控制的单位，是用户定义的一个操作序列。<br>而一个逻辑工作单元要成为事务，就必须满足ACID属性。<br>A：原子性（Atomicity）</p>
<pre><code>事务中的操作要么都不做，要么就全做。
</code></pre>
<p>C：一致性（Consistency）</p>
<pre><code>事务执行的结果必须是从数据库从一个一致性状态转换到另一个一致性状态。
</code></pre>
<p>I：隔离性（Isolation）</p>
<pre><code>一个事务的执行不能被其他事务干扰
</code></pre>
<p>D：持久性（Durability）</p>
<pre><code>一个事务一旦提交，它对数据库中数据的改变就应该是永久性的
</code></pre>
</li>
<li><p>事务的隔离级别</p>
<ul>
<li><p>读未提交（<code>Read Uncommitted</code>）：保证了读取过程中不会读取到非法数据</p>
<p>​             引发脏读（读取了未提交的数据）</p>
</li>
<li><p>读已提交（<code>Read Committed</code>）</p>
<pre><code>        这是大多数数据库系统默认的隔离级别，但不是MySQL默认的
        只能看见已经提交事务所做的改变
        引发不可重复读，不可重读读意味着我们同一事务执行完全相同的select语句时可能看到不一样的结果。
        ——&gt;导致这种情况的原因可能有：(1)有一个交叉的事务有新的commit，导致了数据的改变;(2)一个数据库被多个实例操作时,同一事务的其他实例在该实例处理其间可能会有新的commit
                多个commit提交时，只读一次出现结果不一致
</code></pre>
</li>
<li><p>可重复读（<code>Repeatable Read</code>）：保证了一个事务不会修改已经由另一个事务读取但未提交（回滚）的数据</p>
<p>​        这是MySQL的默认事务隔离级别<br>​        它确保同一事务的多个实例在并发读取数据时，看到同样的数据行<br>​        此级别可能出现的问题–幻读（Phantom Read），当用户读取某一范围的数据行时，另一个事务又在该范围内插入了新行，当用户再读取该范围的数据行时，会发现有新的“幻影” 行<br>​        InnoDB和Falcon存储引擎通过多版本并发控制(MVCC，Multiversion Concurrency Control)机制解决了该问题</p>
</li>
<li><p>可串行化（<code>Serializable</code>）：最严格，串行处理，消耗资源大</p>
<p>​            这是最高的隔离级别<br>​            它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之，它在每个读的数据行上加上共享锁。<br>​            可能导致大量的超时现象和锁竞争</p>
</li>
</ul>
</li>
<li><p>常见的传播行为</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">PROPAGATION_REQUIRED--支持当前事务，如果当前没有事务，就新建一个事务,最常见的选择。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PROPAGATION_SUPPORTS--支持当前事务，如果当前没有事务，就以非事务方式执行。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PROPAGATION_MANDATORY--支持当前事务，如果当前没有事务，就抛出异常。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">PROPAGATION_REQUIRES_NEW--新建事务，如果当前存在事务，把当前事务挂起,</span> <span class="string">两个事务之间没有关系，一个异常，一个提交，不会同时回滚</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PROPAGATION_NOT_SUPPORTED--以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">PROPAGATION_NEVER--以非事务方式执行，如果当前存在事务，则抛出异常</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="7-5-SpringBoot整合mybatis之事务处理实战"><a href="#7-5-SpringBoot整合mybatis之事务处理实战" class="headerlink" title="7.5-SpringBoot整合mybatis之事务处理实战"></a>7.5-SpringBoot整合mybatis之事务处理实战</h3><ul>
<li>service逻辑引入事务</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setAge(<span class="number">88</span>);</span><br><span class="line">        user.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        user.setName(<span class="string">&quot;事务测试&quot;</span>);</span><br><span class="line">        user.setPhone(<span class="string">&quot;000121212&quot;</span>);</span><br><span class="line"></span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user.getId();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="8-SpringBoot整合Redis"><a href="#8-SpringBoot整合Redis" class="headerlink" title="8-SpringBoot整合Redis"></a>8-SpringBoot整合Redis</h2><h3 id="8-1-分布式缓存Redis介绍"><a href="#8-1-分布式缓存Redis介绍" class="headerlink" title="8.1-分布式缓存Redis介绍"></a>8.1-分布式缓存Redis介绍</h3><p>REmote DIctionary Server(Redis) 是一个由Salvatore Sanfilippo写的key-value存储系统。</p>
<p>Redis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>
<p>它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Hash), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。</p>
<ol>
<li><p>redis官网 <a target="_blank" rel="noopener" href="https://redis.io/download">https://redis.io/download</a></p>
</li>
<li><p>新手入门redis在线测试工具：<a target="_blank" rel="noopener" href="http://try.redis.io/">http://try.redis.io/</a></p>
</li>
</ol>
<h3 id="8-2-源码编译安装Redis4-x"><a href="#8-2-源码编译安装Redis4-x" class="headerlink" title="8.2-源码编译安装Redis4.x"></a>8.2-源码编译安装Redis4.x</h3><ol>
<li><p>快速安装  <a target="_blank" rel="noopener" href="https://redis.io/download#installation">https://redis.io/download#installation</a></p>
<pre><code>    wget http://download.redis.io/releases/redis-4.0.9.tar.gz
       tar xzf redis-4.0.9.tar.gz
       cd redis-4.0.9
       make
</code></pre>
<p> 启动服务端：src/redis-server<br> 启动客户端：src/redis-cli</p>
</li>
<li><p>默认是本地访问的，需要开放外网访问</p>
<pre><code>1）打开redis.conf文件在NETWORK部分修改
      注释掉bind 127.0.0.1可以使所有的ip访问redis
      修改 protected-mode，值改为no
</code></pre>
</li>
</ol>
<h3 id="8-3-SpringBoot整合redis实战"><a href="#8-3-SpringBoot整合redis实战" class="headerlink" title="8.3-SpringBoot整合redis实战"></a>8.3-SpringBoot整合redis实战</h3><ol>
<li><p>官网：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#boot-features-redis">https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#boot-features-redis</a><br>集群文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/data-redis/docs/current/reference/html/#cluster">https://docs.spring.io/spring-data/data-redis/docs/current/reference/html/#cluster</a></p>
</li>
<li><p>springboot整合redis相关依赖引入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>相关配置文件配置</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#=========redis基础配置=========</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment"># 连接超时时间 单位 ms（毫秒）</span></span><br><span class="line"><span class="meta">spring.redis.timeout</span>=<span class="string">3000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#=========redis线程池设置=========</span></span><br><span class="line"><span class="comment"># 连接池中的最大空闲连接，默认值也是8。</span></span><br><span class="line"><span class="meta">spring.redis.pool.max-idle</span>=<span class="string">200</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#连接池中的最小空闲连接，默认值也是0。</span></span><br><span class="line"><span class="meta">spring.redis.pool.min-idle</span>=<span class="string">200</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment"># 如果赋值为-1，则表示不限制；pool已经分配了maxActive个jedis实例，则此时pool的状态为exhausted(耗尽)。</span></span><br><span class="line"><span class="meta">spring.redis.pool.max-active</span>=<span class="string">2000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 等待可用连接的最大时间，单位毫秒，默认值为-1，表示永不超时</span></span><br><span class="line"><span class="meta">spring.redis.pool.max-wait</span>=<span class="string">1000</span></span><br></pre></td></tr></table></figure></li>
<li><p>常见redistemplate种类讲解和缓存实操(使用自动注入)</p>
<ul>
<li><p>注入模板</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">		<span class="keyword">private</span> StirngRedisTemplate strTplRedis</span><br></pre></td></tr></table></figure></li>
<li><p>类型String,List,Hash,Set,ZSet</p>
<pre><code>对应的方法分别是opsForValue()、opsForList()、opsForHash()、opsForSet()、opsForZSet()
</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="8-5-Redis配置类和工具类"><a href="#8-5-Redis配置类和工具类" class="headerlink" title="8.5-Redis配置类和工具类"></a>8.5-Redis配置类和工具类</h3><ol>
<li><p>RedisTemplate的自动配置（源代码如下）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;RedisOperations.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;RedisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisAutoConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">        name = &#123;&quot;redisTemplate&quot;&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过源码可以看出，SpringBoot自动帮我们在容器中生成了一个<code>RedisTemplate</code>和一个<code>StringRedisTemplate</code>。但是，这个RedisTemplate的泛型是&lt;Object,Object&gt;，写代码不方便，需要写好多类型转换的代码；我们需要一个泛型为&lt;String,Object&gt;形式的RedisTemplate。并且，这个RedisTemplate没有设置数据存在Redis时，key及value的序列化方式。</p>
<pre><code>    看到这个@ConditionalOnMissingBean注解后，就知道如果Spring容器中有了RedisTemplate对象了，这个自动配置的RedisTemplate不会实例化。因此我们可以直接自己写个配置类，配置RedisTemplate。
</code></pre>
</li>
<li><p>重新写一个Redis配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Redis配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">// key采用String的序列化方式</span></span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// hash的key也采用String的序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// value序列化方式采用jackson</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hash的value序列化方式采用jackson</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>封装Redis工具类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="comment">// =============================common============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定缓存失效时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key 获取过期时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 时间(秒) 返回0代表为永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断key是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 可以传一个值 或多个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String... key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="keyword">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================String=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存获取</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="keyword">null</span> ? <span class="keyword">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) time要大于0 如果time小于等于0 将设置无限期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递增</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要增加几(大于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;递增因子必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要减少几(小于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;递减因子必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================================Map=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取hashKey对应的所有键值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应的多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">hmget</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet 并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map  对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除hash表中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 可以使多个 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hdel</span><span class="params">(String key, Object... item)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断hash表中是否有该项的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hHasKey</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要增加几(大于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hincr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要减少记(小于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hdecr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ============================set=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key获取Set中的所有值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sGet</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据value从一个set中查询,是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sHasKey</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将数据放入set缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSet</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将set数据放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time   时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSetAndTime</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">                expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取set缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sGetSetSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除值为value的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setRemove</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ===============================list=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end   结束 0 到 -1代表所有值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">lGet</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lGetListSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过索引 获取list中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lGetIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">                expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     * å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">                expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据索引修改list中的某条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lUpdateIndex</span><span class="params">(String key, <span class="keyword">long</span> index, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除N个值为value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 移除多少个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            <span class="keyword">return</span> remove;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="9-SpringBoot整合定时任务和异步任务"><a href="#9-SpringBoot整合定时任务和异步任务" class="headerlink" title="9-SpringBoot整合定时任务和异步任务"></a>9-SpringBoot整合定时任务和异步任务</h2><h3 id="9-1-SpringBoot定时任务schedule"><a href="#9-1-SpringBoot定时任务schedule" class="headerlink" title="9.1-SpringBoot定时任务schedule"></a>9.1-SpringBoot定时任务schedule</h3><ol>
<li><p>常见定时任务</p>
<ul>
<li><p>Java自带的java.util.Timer类</p>
<p>timer:配置比较麻烦，时间延后问题<br>timertask:不推荐</p>
</li>
<li><p>Quartz框架</p>
<p>配置更简单<br>xml或者注解</p>
</li>
<li><p>SpringBoot使用注解方式开启定时任务</p>
<ul>
<li>启动类里面 @EnableScheduling开启定时任务，自动扫描</li>
<li>定时任务业务类 加注解 @Component被容器扫描</li>
<li>定时执行的方法加上注解 @Scheduled(fixedRate=2000) 定期执行一次</li>
</ul>
</li>
</ul>
</li>
<li><p>定时任务schedule</p>
<p>SpringBoot内置了定时任务Scheduled，能够很好的实现定时任务。</p>
<ul>
<li>在SpringBoot应用添加<code>@EnableScheduling</code>注解启动定时任务</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootTestApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootTestApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>添加测试定时任务的代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;5 0 0 * * ?&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduledTask1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;定时任务1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(initialDelay =  1000 * 10,fixedDelay = 1000 * 5)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduledTask2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;任务2执行时间：&quot;</span>+System.currentTimeMillis());</span><br><span class="line">        System.out.println(<span class="string">&quot;定时任务2&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2</span>*<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;任务2结束时间：&quot;</span>+System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(initialDelay =  1000 * 10,fixedRate = 1000 * 5)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduledTask3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;任务3执行时间：&quot;</span>+System.currentTimeMillis());</span><br><span class="line">        System.out.println(<span class="string">&quot;定时任务3&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2</span>*<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;任务3结束时间：&quot;</span>+System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong></p>
<ul>
<li>corn表达式在linux使用广泛，具体可以参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/javahr/p/8318728.html">cron表达式详解</a>以及在线<a target="_blank" rel="noopener" href="https://tool.lu/crontab/">Cron表达式生成器</a></li>
<li>initialDelay：启动后多久开始执行，单位时毫秒</li>
<li>fixedRate：下次执行时间，任务开始运行的时候就计时</li>
<li>fixedDelay：下次执行时间，fixedDelay等任务进行完了才开始计时，上一次执行结束时间点后xx秒再次执行</li>
<li>fixedDelayString:  字符串形式，可以通过配置文件指定</li>
</ul>
<h3 id="9-2-SpringBoot异步任务"><a href="#9-2-SpringBoot异步任务" class="headerlink" title="9.2-SpringBoot异步任务"></a>9.2-SpringBoot异步任务</h3><ol>
<li><p>启动类里面使用@EnableAsync注解开启功能，自动扫描</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>定义异步任务类并使用@Component标记组件被容器扫描,异步方法加上@Async</p>
<pre><code>    注意点：
           1）要把异步任务封装到类里面，不能直接写到Controller
           2）增加Future&lt;String&gt; 返回结果 AsyncResult&lt;String&gt;(&quot;task执行完成&quot;);  
           3）如果需要拿到结果 需要判断全部的 task.isDone()
</code></pre>
<p><code>@EnableAsync</code> 表示支持异步任务，springboot对于异步，定时，缓存，切面等的配置都是通过在启动类上加 @EnableXXX来配置的。</p>
<p><code>@Async</code>表示该方法会异步执行，也就是说主线程会直接跳过该方法，而是使用线程池中的线程来执行该方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">execTaskA</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;TaskA开始&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> star = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> end = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;TaskA结束，耗时毫秒数：&quot;</span> + (end - star));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;&gt;(<span class="string">&quot;TaskA结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">execTaskB</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;TaskB开始&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> star = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> end = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;TaskB结束，耗时毫秒数：&quot;</span> + (end - star));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;&gt;(<span class="string">&quot;TaskB结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">execTaskC</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;TaskC开始&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> star = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        Thread.sleep(<span class="number">4000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> end = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;TaskC结束，耗时毫秒数：&quot;</span> + (end - star));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;&gt;(<span class="string">&quot;TaskC结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>通过注入方式，注入到controller里面，如果测试前后区别则改为同步则把Async注释掉</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AsyncTask asyncTask;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testTask&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTask</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;任务开始，当前时间&quot;</span> +star );</span><br><span class="line"></span><br><span class="line">        Future&lt;String&gt; taskA = asyncTask.execTaskA();</span><br><span class="line">        Future&lt;String&gt; taskB = asyncTask.execTaskB();</span><br><span class="line">        Future&lt;String&gt; taskC = asyncTask.execTaskC();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//间隔一秒轮询 直到 A B C 全部完成</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (taskA.isDone() &amp;&amp; taskB.isDone() &amp;&amp; taskC.isDone()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> end = <span class="keyword">new</span> Date().getTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;任务结束，当前时间&quot;</span> + end);</span><br><span class="line">        System.out.println(<span class="string">&quot;总耗时：&quot;</span>+(end-start));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="9-3-SpringBootz整合Quartz"><a href="#9-3-SpringBootz整合Quartz" class="headerlink" title="9.3-SpringBootz整合Quartz"></a>9.3-SpringBootz整合Quartz</h3><p>Quartz是一款功能强大的任务调度器，可以实现较为复杂的调度功能，如每月一号执行、每天凌晨执行、每周五执行等等，还支持分布式调度。本文使用Springboot+Mybatis+Quartz实现对定时任务的增、删、改、查、启用、停用等功能。并把定时任务持久化到数据库以及支持集群。</p>
<h4 id="Quartz的3个基本要素"><a href="#Quartz的3个基本要素" class="headerlink" title="Quartz的3个基本要素"></a>Quartz的3个基本要素</h4><ul>
<li>Scheduler：调度器。所有的调度都是由它控制。</li>
<li>Trigger： 触发器。决定什么时候来执行任务。</li>
<li>JobDetail &amp; Job： JobDetail定义的是任务数据，而真正的执行逻辑是在Job中。使用JobDetail + Job而不是Job，这是因为任务是有可能并发执行，如果Scheduler直接使用Job，就会存在对同一个Job实例并发访问的问题。而JobDetail &amp; Job 方式，sheduler每次执行，都会根据JobDetail创建一个新的Job实例，这样就可以规避并发访问的问题。</li>
</ul>
<ol>
<li><p>引入依赖jar包</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--QuartZ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>添加配置application-quartz.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment">#配置数据源</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/testquartz?serverTimezone=UTC&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">password</span></span><br><span class="line">  <span class="attr">quartz:</span></span><br><span class="line">    <span class="comment">#持久化到数据库方式</span></span><br><span class="line">    <span class="attr">job-store-type:</span> <span class="string">jdbc</span></span><br><span class="line">    <span class="attr">initialize-schema:</span> <span class="string">embedded</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">org:</span></span><br><span class="line">        <span class="attr">quartz:</span></span><br><span class="line">          <span class="attr">scheduler:</span></span><br><span class="line">            <span class="attr">instanceName:</span> <span class="string">MyScheduler</span></span><br><span class="line">            <span class="attr">instanceId:</span> <span class="string">AUTO</span></span><br><span class="line">          <span class="attr">jobStore:</span></span><br><span class="line">            <span class="attr">class:</span> <span class="string">org.quartz.impl.jdbcjobstore.JobStoreTX</span></span><br><span class="line">            <span class="attr">driverDelegateClass:</span> <span class="string">org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span><br><span class="line">            <span class="attr">tablePrefix:</span> <span class="string">QRTZ_</span></span><br><span class="line">            <span class="attr">isClustered:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">clusterCheckinInterval:</span> <span class="number">10000</span></span><br><span class="line">            <span class="attr">useProperties:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">threadPool:</span></span><br><span class="line">            <span class="attr">class:</span> <span class="string">org.quartz.simpl.SimpleThreadPool</span></span><br><span class="line">            <span class="attr">threadCount:</span> <span class="number">10</span></span><br><span class="line">         <span class="attr">threadPriority:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">threadsInheritContextClassLoaderOfInitializingThread:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
<li><p>实现<code>Job</code>接口并且在<code>execute</code>方法中实现自己的业务逻辑</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloworldJob</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloworldService helloworldService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext jobExecutionContext)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        helloworldService.printHelloWorld();</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello world! :&quot;</span> + jobExecutionContext.getJobDetail().getKey());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>添加配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JobDetail <span class="title">myJobDetail</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JobDetail jobDetail = JobBuilder.newJob(HiJob.class)</span><br><span class="line">                .withIdentity(<span class="string">&quot;myJob1&quot;</span>,<span class="string">&quot;myJobGroup1&quot;</span>)</span><br><span class="line">                <span class="comment">//JobDataMap可以给任务execute传递参数</span></span><br><span class="line">                .usingJobData(<span class="string">&quot;job_param&quot;</span>,<span class="string">&quot;job_param1&quot;</span>)</span><br><span class="line">                .storeDurably()</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> jobDetail;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Trigger <span class="title">myTrigger</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Trigger trigger = TriggerBuilder.newTrigger()</span><br><span class="line">                .forJob(myJobDetail())</span><br><span class="line">                .withIdentity(<span class="string">&quot;myTrigger1&quot;</span>,<span class="string">&quot;myTriggerGroup1&quot;</span>)</span><br><span class="line">                .usingJobData(<span class="string">&quot;job_trigger_param&quot;</span>,<span class="string">&quot;job_trigger_param1&quot;</span>)</span><br><span class="line">                .startNow()</span><br><span class="line">                <span class="comment">//.withSchedule(SimpleScheduleBuilder.simpleSchedule().withIntervalInSeconds(5).repeatForever())</span></span><br><span class="line">                .withSchedule(CronScheduleBuilder.cronSchedule(<span class="string">&quot;0/5 * * * * ? 2018&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> trigger;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Quartz使用同一组数据库表作集群只需要配置相同的<code>instanceName</code>实例名称，以及设置<code>org.quartz.jobStore.isClustered = true</code><br>启动两个节点后关闭其中正在跑任务的节点，另一个节点会自动检测继续运行定时任务</p>
</li>
</ol>
<p>注：多任务的问题，多个<code>JobDetail</code>使用同一个<code>Trigger</code>报错：<code>Trigger does not reference given job!</code></p>
<p>​        一个Job可以对应多个Trigger，但多个Job绑定一个Trigger报错。</p>
<h2 id="10-Logback日志框架介绍和SpringBoot整合"><a href="#10-Logback日志框架介绍和SpringBoot整合" class="headerlink" title="10-Logback日志框架介绍和SpringBoot整合"></a>10-Logback日志框架介绍和SpringBoot整合</h2><h3 id="10-1-新日志框架LogBack介绍"><a href="#10-1-新日志框架LogBack介绍" class="headerlink" title="10.1-新日志框架LogBack介绍"></a>10.1-新日志框架LogBack介绍</h3><ol>
<li><p>常用处理java的日志组件 slf4j,log4j,logback,common-logging 等</p>
</li>
<li><p>logback介绍：</p>
<p>​    基于Log4j基础上大量改良，不能单独使用，推荐配合日志框架SLF4J来使用<br>​    logback当前分成三个模块：logback-core,logback-classic和logback-access;<br>​    logback-core是其它两个模块的基础模块</p>
</li>
<li><p>Logback的核心对象：</p>
<pre><code>Logger：日志记录器
   Appender：指定日志输出的目的地，目的地可以是控制台，文件
   Layout：日志布局 格式化日志信息的输出
</code></pre>
</li>
<li><p>日志级别：DEBUG &lt; INFO &lt; WARN &lt; ERROR</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line">===========<span class="meta">log4j示例</span>=<span class="string">==========		</span></span><br><span class="line"><span class="comment">### 设置###</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span> = <span class="string">debug,stdout,D,E</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">### 输出信息到控制抬 ###</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span> = <span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.Target</span> = <span class="string">System.out</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span> = <span class="string">[%-5p] %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; method:%l%n%m%n</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">### 输出DEBUG 级别以上的日志到=D://logs/error.log ###</span></span><br><span class="line"><span class="meta">log4j.appender.D</span> = <span class="string">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.D.File</span> = <span class="string">D://logs/log.log</span></span><br><span class="line"><span class="meta">log4j.appender.D.Append</span> = <span class="string">true</span></span><br><span class="line"><span class="meta">log4j.appender.D.Threshold</span> = <span class="string">DEBUG </span></span><br><span class="line"><span class="meta">log4j.appender.D.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.D.layout.ConversionPattern</span> = <span class="string">%-d&#123;yyyy-MM-dd HH:mm:ss&#125;  [ %t:%r ] - [ %p ]  %m%n</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">### 输出ERROR 级别以上的日志到=D://logs/error.log ###</span></span><br><span class="line"><span class="meta">log4j.appender.E</span> = <span class="string">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.E.File</span> =<span class="string">E://logs/error.log </span></span><br><span class="line"><span class="meta">log4j.appender.E.Append</span> = <span class="string">true</span></span><br><span class="line"><span class="meta">log4j.appender.E.Threshold</span> = <span class="string">ERROR </span></span><br><span class="line"><span class="meta">log4j.appender.E.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.E.layout.ConversionPattern</span> = <span class="string">%-d&#123;yyyy-MM-dd HH:mm:ss&#125;  [ %t:%r ] - [ %p ]  %m%n </span></span><br></pre></td></tr></table></figure></li>
<li><p>Log4j日志转换为logback在线工具（支持log4j.properties转换为logback.xml,不支持 log4j.xml转换为logback.xml） <a target="_blank" rel="noopener" href="https://logback.qos.ch/translator/">https://logback.qos.ch/translator/</a></p>
</li>
</ol>
<h3 id="10-2-SpringBoot2-x日志讲解和Logback"><a href="#10-2-SpringBoot2-x日志讲解和Logback" class="headerlink" title="10.2-SpringBoot2.x日志讲解和Logback"></a>10.2-SpringBoot2.x日志讲解和Logback</h3><ol>
<li><p>官网介绍：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#boot-features-logging">https://docs.spring.io/spring-boot/docs/2.1.0.BUILD-SNAPSHOT/reference/htmlsingle/#boot-features-logging</a></p>
<p>各个组件案例：<a target="_blank" rel="noopener" href="https://logback.qos.ch/manual/index.html">https://logback.qos.ch/manual/index.html</a></p>
</li>
<li><p>分析SpringBoot启动日志</p>
<ul>
<li>默认情况下，Spring Boot将日志输出到控制台</li>
</ul>
</li>
<li><p>整合Logback实战</p>
<ul>
<li>创建 日志文件logback-spring.xml，官方推荐 -spring.xml结尾<br>默认加载加载配置顺序 logback-spring.xml, logback-spring.groovy, logback.xml, or logback.groovy</li>
</ul>
</li>
<li><p>注释：</p>
<pre><code>&lt;configuration&gt; 子节点
   &lt;appender&gt;&lt;/appender&gt;                       
   &lt;logger&gt;&lt;/logger&gt;
   &lt;root&gt;&lt;/root&gt;(要加在最后)        
</code></pre>
</li>
</ol>
<p><code>Logback.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;1 seconds&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--定义参数,后面可以通过$&#123;app.name&#125;使用--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;app.name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;logback_test&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ConsoleAppender 用于在屏幕上输出日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;stdout&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义了一个过滤器,在LEVEL之下的日志输出不会被打印出来--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这里定义了DEBUG，也就是控制台不会输出比ERROR级别小的日志--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- encoder 默认配置为PatternLayoutEncoder --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义控制台输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d [%thread] %-5level %logger&#123;36&#125; [%file : %line] - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义日志输出的路径--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--这里的scheduler.manager.server.home 没有在上面的配置中设定，所以会使用java启动时配置的值--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--比如通过 java -Dscheduler.manager.server.home=/path/to XXXX 配置该属性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;scheduler.manager.server.home&#125;/logs/$&#123;app.name&#125;.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义日志滚动的策略--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--定义文件滚动时的文件名的格式--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;scheduler.manager.server.home&#125;/logs/$&#123;app.name&#125;.%d&#123;yyyy-MM-dd.HH&#125;.log.gz</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--60天的时间周期，日志量最大20GB--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>60<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 该属性在 1.1.6版本后 才开始支持--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>20GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">triggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--每个日志文件最大100MB--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">triggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d [%thread] %-5level %logger&#123;36&#125; [%file : %line] - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--root是默认的logger 这里设定输出级别是debug--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;trace&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--定义了两个appender，日志会通过往这两个appender里面写--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;stdout&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--对于类路径以 com.example.logback 开头的Logger,输出级别设置为warn,并且只输出到控制台--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这个logger没有指定appender，它会继承root节点中定义的那些appender--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.example.logback&quot;</span> <span class="attr">level</span>=<span class="string">&quot;warn&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--通过 LoggerFactory.getLogger(&quot;mytest&quot;) 可以获取到这个logger--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--由于这个logger自动继承了root的appender，root中已经有stdout的appender了，自己这边又引入了stdout的appender--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--如果没有设置 additivity=&quot;false&quot; ,就会导致一条日志在控制台输出两次的情况--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--additivity表示要不要使用rootLogger配置的appender进行输出--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;mytest&quot;</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;stdout&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--由于设置了 additivity=&quot;false&quot; ，所以输出时不会使用rootLogger的appender--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--但是这个logger本身又没有配置appender，所以使用这个logger输出日志的话就不会输出到任何地方--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;mytest2&quot;</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="11-搜索框架ElasticSearch介绍和整合SpringBoot"><a href="#11-搜索框架ElasticSearch介绍和整合SpringBoot" class="headerlink" title="11-搜索框架ElasticSearch介绍和整合SpringBoot"></a>11-搜索框架ElasticSearch介绍和整合SpringBoot</h2><h3 id="11-1-搜索知识"><a href="#11-1-搜索知识" class="headerlink" title="11.1-搜索知识"></a>11.1-搜索知识</h3><ul>
<li><p>mysql：like 模糊，性能问题</p>
</li>
<li><p>solr:针对企业，Lucene</p>
</li>
<li><p><code>elasticsearch：</code></p>
<p>针对数据量特别大，PB,TB<br>纯java开发，springboot使用，5.6版本<br>es升级4-&gt;5版本，改动大，但是5版本后，改动不大</p>
</li>
</ul>
<h3 id="11-2-ElasticSearch介绍"><a href="#11-2-ElasticSearch介绍" class="headerlink" title="11.2-ElasticSearch介绍"></a>11.2-ElasticSearch介绍</h3><p>Elasticsearch(ES)是一个基于Apache的开源索引库Lucene而构建的开源、分布式、具有RESTful接口的全文搜索引擎, 还是一个分布式文档数据库.</p>
<p>ES可以轻松扩展数以百计的服务器(水平扩展), 用于存储和处理数据. 它可以在很短的时间内存储、搜索和分析海量数据, 通常被作为复杂搜索场景下的核心引擎.</p>
<p><strong>由于Lucene提供的API操作起来非常繁琐, 需要编写大量的代码, Elasticsearch对Lucene进行了封装与优化, 并提供了REST风格的操作接口, 开箱即用, 很大程度上方便了开发人员的使用.</strong></p>
<ul>
<li>elasticSearch主要特点<ol>
<li>特点：全文检索，结构化检索，数据统计、分析，接近实时处理，分布式搜索(可部署数百台服务器)，处理PB级别的数据，搜索纠错，自动完成</li>
<li>使用场景：日志搜索，数据聚合，数据监控，报表统计分析</li>
<li>国内外使用者：维基百科，Stack Overflow，GitHub</li>
</ol>
</li>
</ul>
<h3 id="11-3-SpringBoot整合ElasticSearch"><a href="#11-3-SpringBoot整合ElasticSearch" class="headerlink" title="11.3-SpringBoot整合ElasticSearch"></a>11.3-SpringBoot整合ElasticSearch</h3><ol>
<li>添加依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--elasticsearch--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置文件</li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">elasticsearch:</span></span><br><span class="line">      <span class="attr">cluster-name:</span> <span class="string">esCluster</span></span><br><span class="line">      <span class="attr">cluster-nodes:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9300</span> </span><br><span class="line">      <span class="comment">#配置es节点信息，逗号分隔，如果没有指定，则启动ClientNode（9200端口是http查询使用的。9300集群使用。这里使用9300.）</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建实体类bean</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Document(indexName = &quot;testgoods&quot;, type = &quot;goods&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestGoodsBo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//@Field(type = FieldType.Text)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> stock;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Version</span></span><br><span class="line">    <span class="keyword">private</span> Long version;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>@Document注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Persistent</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Document &#123;</span><br><span class="line">    <span class="function">String <span class="title">indexName</span><span class="params">()</span></span>;<span class="comment">//索引库的名称，个人建议以项目的名称命名</span></span><br><span class="line">    <span class="function">String <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;<span class="comment">//类型，个人建议以实体的名称命名</span></span><br><span class="line">    <span class="function"><span class="keyword">short</span> <span class="title">shards</span><span class="params">()</span> <span class="keyword">default</span> 5</span>;<span class="comment">//默认分区数</span></span><br><span class="line">    <span class="function"><span class="keyword">short</span> <span class="title">replicas</span><span class="params">()</span> <span class="keyword">default</span> 1</span>;<span class="comment">//每个分区默认的备份数</span></span><br><span class="line">    <span class="function">String <span class="title">refreshInterval</span><span class="params">()</span> <span class="keyword">default</span> &quot;1s&quot;</span>;<span class="comment">//刷新间隔</span></span><br><span class="line">    <span class="function">String <span class="title">indexStoreType</span><span class="params">()</span> <span class="keyword">default</span> &quot;fs&quot;</span>;<span class="comment">//索引文件存储类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Document</code>作用于类上，经测试代码初始化时若es中没有对应的索引，则会在es中创建一个。</p>
</li>
<li><p>@Field注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Field &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">FieldType <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> FieldType.Auto</span>;#自动检测属性的类型</span><br><span class="line">    <span class="function">FieldIndex <span class="title">index</span><span class="params">()</span> <span class="keyword">default</span> FieldIndex.analyzed</span>;#默认情况下分词</span><br><span class="line">    <span class="function">DateFormat <span class="title">format</span><span class="params">()</span> <span class="keyword">default</span> DateFormat.none</span>;</span><br><span class="line">    <span class="function">String <span class="title">pattern</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">store</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;#默认情况下不存储原文</span><br><span class="line">    <span class="function">String <span class="title">searchAnalyzer</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;#指定字段搜索时使用的分词器</span><br><span class="line">    <span class="function">String <span class="title">indexAnalyzer</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;#指定字段建立索引时指定的分词器</span><br><span class="line">    String[] ignoreFields() <span class="keyword">default</span> &#123;&#125;;#如果某个字段需要被忽略</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">includeInParent</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Field</code>作用于属性上，经测试该注解的属性有时会与现有的属性冲突，造成异常，错误信息如下，所以建议es中映射已建立的情况下，不要使用该注解。</p>
</li>
<li><p><code>@Id</code>和<code>@Version</code>分别用来绑定es中的<code>_id</code>和<code>_version</code>字段。</p>
</li>
</ul>
<ol start="4">
<li>创建Repository(接口继承ElasticSearchRepository)</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GoodsRepository</span> <span class="keyword">extends</span> <span class="title">ElasticsearchRepository</span>&lt;<span class="title">TestGoodsBo</span>,<span class="title">Long</span>&gt; , <span class="title">PagingAndSortingRepository</span>&lt;<span class="title">TestGoodsBo</span>,<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function">List&lt;TestGoodsBo&gt; <span class="title">findByNameAndPrice</span><span class="params">(String name, Long price)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">List&lt;TestGoodsBo&gt; <span class="title">findByNameOrPrice</span><span class="params">(String name, Long price)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="function">Page&lt;TestGoodsBo&gt; <span class="title">findByName</span><span class="params">(String name,Pageable page)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">Page&lt;TestGoodsBo&gt; <span class="title">findByNameNot</span><span class="params">(String name,Pageable page)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">Page&lt;TestGoodsBo&gt; <span class="title">findByPriceBetween</span><span class="params">(<span class="keyword">long</span> price,Pageable page)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">Page&lt;TestGoodsBo&gt; <span class="title">findByNameLike</span><span class="params">(String name,Pageable page)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Query(&quot;&#123;\&quot;bool\&quot; : &#123;\&quot;must\&quot; : &#123;\&quot;term\&quot; : &#123;\&quot;message\&quot; : \&quot;?0\&quot;&#125;&#125;&#125;&#125;&quot;)</span></span><br><span class="line">        <span class="function">Page&lt;TestGoodsBo&gt; <span class="title">findByMessage</span><span class="params">(String message, Pageable pageable)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>es的操作主要通过自定义的Repository对象完成，该对象可以通过继承模板接口<code>ElasticsearchRepository</code>实现，该模板提供了<code>save</code>、<code>findById</code>、<code>findAll</code>和<code>search</code>等通用方法的实现，同时还支持通过规定的名称格式自定义操作方法.</p>
<ol start="5">
<li>使用</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/search&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GoodsRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ElasticsearchTemplate elasticsearchTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TestGoodsBo <span class="title">insert</span><span class="params">(<span class="meta">@RequestBody</span> TestGoodsBo bo)</span> </span>&#123;</span><br><span class="line">        repository.save(bo);</span><br><span class="line">        <span class="keyword">return</span> bo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/get&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TestGoodsBo <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Optional&lt;TestGoodsBo&gt; result = repository.findById(<span class="number">1L</span>);</span><br><span class="line">        <span class="keyword">return</span> result.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/find&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TestGoodsBo&gt; <span class="title">find</span><span class="params">(String name,Pageable page)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> repository.findByName(name, page);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/search&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;TestGoodsBo&gt; <span class="title">search</span><span class="params">(String name, <span class="meta">@PageableDefault(value = 15, sort = &#123; &quot;id&quot; &#125;, direction = Sort.Direction.DESC)</span>Pageable pageable)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        //通过ElasticsearchTemplate实现</span></span><br><span class="line"><span class="comment">//        QueryBuilder queryBuilder = QueryBuilders.matchQuery(&quot;name&quot;, name);</span></span><br><span class="line"><span class="comment">//        SearchQuery searchQuery = new NativeSearchQueryBuilder().withQuery(queryBuilder).withHighlightFields().build();</span></span><br><span class="line"><span class="comment">//        Page&lt;TestGoodsBo&gt; sampleEntities = elasticsearchTemplate.queryForPage(searchQuery, TestGoodsBo.class);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        //Pageable对象的手动实现</span></span><br><span class="line"><span class="comment">//        Sort sort = new Sort(Sort.Direction.ASC,&quot;name&quot;);</span></span><br><span class="line"><span class="comment">//        Pageable page = PageRequest.of(0,10,sort);</span></span><br><span class="line"></span><br><span class="line">        Page&lt;TestGoodsBo&gt; sampleEntities = repository.search(QueryBuilders.matchQuery(<span class="string">&quot;name&quot;</span>, name),pageable);</span><br><span class="line">        <span class="keyword">return</span> sampleEntities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>Pageable对象</li>
</ol>
<p>该对象可以帮助我们完成分页和排序操作，有手动和自动两种方式实现：</p>
<ul>
<li><p>手动</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Sort sort = <span class="keyword">new</span> Sort(Sort.Direction.ASC,<span class="string">&quot;name&quot;</span>);</span><br><span class="line">Pageable page = PageRequest.of(<span class="number">0</span>,<span class="number">10</span>,sort);</span><br></pre></td></tr></table></figure></li>
<li><p>自动</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/search&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;TestGoodsBo&gt; <span class="title">search</span><span class="params">(String name, <span class="meta">@PageableDefault(value = 15, sort = &#123; &quot;id&quot; &#125;, direction = Sort.Direction.DESC)</span>Pageable pageable)</span></span></span><br></pre></td></tr></table></figure>

<p>自动方式可以在request传参的同时就根据传入的参数来组装<code>Pageable</code>对象，同时还能使用<code>@PageableDefault</code>注解设定默认值，因此更推荐使用。</p>
<p>Spring支持的request参数如下：</p>
<ul>
<li><p>page，第几页，从0开始，默认为第0页</p>
</li>
<li><p>size，每一页的大小，默认为20</p>
</li>
<li><p>sort，排序相关的信息，例如sort=firstname&amp;sort=lastname,desc表示在按firstname正序排列基础上按lastname倒序排列</p>
</li>
</ul>
</li>
</ul>
<h2 id="12-消息队列介绍和SpringBoot整合RockketMQ、ActiveMQ"><a href="#12-消息队列介绍和SpringBoot整合RockketMQ、ActiveMQ" class="headerlink" title="12-消息队列介绍和SpringBoot整合RockketMQ、ActiveMQ"></a>12-消息队列介绍和SpringBoot整合RockketMQ、ActiveMQ</h2><h3 id="12-1-JMS介绍和使用场景及基础编程模型"><a href="#12-1-JMS介绍和使用场景及基础编程模型" class="headerlink" title="12.1-JMS介绍和使用场景及基础编程模型"></a>12.1-JMS介绍和使用场景及基础编程模型</h3><ol>
<li><p>什么是JMS？</p>
<p>Java消息服务（Java Message Service),Java平台中关于面向消息中间件的接口</p>
</li>
<li><p>JMS是一种与厂商无关的 API，用来访问消息收发系统消息，它类似于JDBC(Java Database Connectivity)。这里，JDBC 是可以用来访问许多不同关系数据库的 API</p>
</li>
<li><p>使用场景</p>
<ul>
<li>跨平台 </li>
<li>多语言 </li>
<li>多项目</li>
<li>解耦</li>
<li>分布式事务</li>
<li>流量控制</li>
<li>最终一致性</li>
<li>RPC调用</li>
</ul>
</li>
<li><p>概念</p>
<ul>
<li>JMS提供者：Apache ActiveMQ、RabbitMQ、Kafka、Notify、MetaQ、RocketMQ</li>
<li>JMS生产者(Message Producer)</li>
<li>JMS消费者(Message Consumer)</li>
<li>JMS消息</li>
<li>JMS队列</li>
<li>JMS主题</li>
</ul>
<p>JMS消息通常有两种类型：<code>点对点</code>、<code>发布/订阅</code></p>
</li>
<li><p>编程模型</p>
<p>MQ中需要用的一些类</p>
<pre><code>ConnectionFactory ：连接工厂，JMS 用它创建连接
Connection ：JMS 客户端到JMS Provider 的连接
Session： 一个发送或接收消息的线程
Destination ：消息的目的地;消息发送给谁
MessageConsumer / MessageProducer： 消息接收者，消费者
</code></pre>
</li>
</ol>
<h3 id="12-2-ActiveMQ消息队列基础介绍"><a href="#12-2-ActiveMQ消息队列基础介绍" class="headerlink" title="12.2-ActiveMQ消息队列基础介绍"></a>12.2-ActiveMQ消息队列基础介绍</h3><p>ActiveMQ是一种开源的基于JMS规范的一种消息中间件的实现，ActiveMQ的设计目标是提供标准的，面向消息的，能够跨越多语言和多系统的应用集成消息通信中间件。</p>
<p><strong>特点：</strong></p>
<ul>
<li>支持来自Java，C，C ++，C＃，Ruby，Perl，Python，PHP的各种跨语言客户端和协议</li>
<li>支持许多高级功能，如消息组，虚拟目标，通配符和复合目标</li>
<li>完全支持JMS 1.1和J2EE 1.4，支持瞬态，持久，事务和XA消息</li>
<li>Spring支持，ActiveMQ可以轻松嵌入到Spring应用程序中，并使用Spring的XML配置机制进行配置</li>
<li>支持在流行的J2EE服务器（如TomEE，Geronimo，JBoss，GlassFish和WebLogic）中进行测试</li>
<li>使用JDBC和高性能日志支持非常快速的持久化</li>
</ul>
<h3 id="12-3-SpringBoot2整合ActiveMQ实战之点对点消息"><a href="#12-3-SpringBoot2整合ActiveMQ实战之点对点消息" class="headerlink" title="12.3-SpringBoot2整合ActiveMQ实战之点对点消息"></a>12.3-SpringBoot2整合ActiveMQ实战之点对点消息</h3><ol>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 整合消息队列ActiveMQ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-activemq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 如果配置线程池则加入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-pool<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置文件</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#整合jms测试，安装在别的机器，防火墙和端口号记得开放</span></span><br><span class="line"><span class="meta">spring.activemq.broker-url</span>=<span class="string">tcp://127.0.0.1:61616</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#集群配置</span></span><br><span class="line"><span class="comment">#spring.activemq.broker-url=failover:(tcp://localhost:61616,tcp://localhost:61617)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.activemq.user</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">spring.activemq.password</span>=<span class="string">admin</span></span><br><span class="line"><span class="comment">#下列配置要增加依赖</span></span><br><span class="line"><span class="meta">spring.activemq.pool.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.activemq.pool.max-connections</span>=<span class="string">100</span></span><br></pre></td></tr></table></figure></li>
<li><p>启动类添加@EnableJms注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableJms</span> <span class="comment">//启动消息队列</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(ProductApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>QueueConfig定义消息队列</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.jms.Queue;</span><br><span class="line"><span class="keyword">import</span> org.apache.activemq.command.ActiveMQQueue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueueConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">//定义存放消息的队列</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQQueue(<span class="string">&quot;ActiveMQQueue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ProviderController测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductController</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//注入存放消息的队列，用于下列方法一</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Queue queue;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//注入springboot封装的工具类</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JmsMessagingTemplate jmsMessagingTemplate;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@GetMapping(&quot;send&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//方法一：添加消息到消息队列</span></span><br><span class="line">        jmsMessagingTemplate.convertAndSend(queue, message);</span><br><span class="line">        <span class="comment">//方法二：这种方式不需要手动创建queue，系统会自行创建名为test的队列</span></span><br><span class="line">        <span class="comment">//jmsMessagingTemplate.convertAndSend(&quot;test&quot;, message);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>消费者应用</p>
<p>application.properties 和 ConsumerApplication 同 provider类似，如下为不同的ActiveConsumer：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActiveConsumer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JmsMessagingTemplate jmsMessagingTemplate;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 使用JmsListener配置消费者监听的队列，其中message是接收到的消息</span></span><br><span class="line">    <span class="meta">@JmsListener(destination = &quot;ActiveMQQueue&quot;)</span></span><br><span class="line">    <span class="comment">// SendTo 会将此方法返回的数据, 写入到 OutQueue 中去.</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;SQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">handleMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;成功接受message&quot;</span> + message);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功接受message&quot;</span> + message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>模拟请求 <code>localhost:8080/send?msg=123</code></p>
</li>
</ol>
<h3 id="12-4-SpringBoot整合ActiveMQ实战之发布订阅模式"><a href="#12-4-SpringBoot整合ActiveMQ实战之发布订阅模式" class="headerlink" title="12.4-SpringBoot整合ActiveMQ实战之发布订阅模式"></a>12.4-SpringBoot整合ActiveMQ实战之发布订阅模式</h3><ol>
<li><p>需要加入配置文件，支持发布订阅模型，默认只支持点对点</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#default point to point</span></span><br><span class="line"><span class="comment">#默认消费者并不会消费订阅发布类型的消息，这是由于springboot默认采用的是p2p模式进行消息的监听</span></span><br><span class="line"><span class="meta">spring.jms.pub-sub-domain</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure></li>
<li><p>新建JMS配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JmsConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String TOPIC = <span class="string">&quot;springboot.topic.test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String QUEUE = <span class="string">&quot;springboot.queue.test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Topic <span class="title">topic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQTopic(TOPIC);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ActiveMQQueue(QUEUE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// topic模式的ListenerContainer</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JmsListenerContainerFactory&lt;?&gt; jmsListenerContainerTopic(ConnectionFactory activeMQConnectionFactory) &#123;</span><br><span class="line">        DefaultJmsListenerContainerFactory bean = <span class="keyword">new</span> DefaultJmsListenerContainerFactory();</span><br><span class="line">        bean.setPubSubDomain(<span class="keyword">true</span>);</span><br><span class="line">        bean.setConnectionFactory(activeMQConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// queue模式的ListenerContainer</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JmsListenerContainerFactory&lt;?&gt; jmsListenerContainerQueue(ConnectionFactory activeMQConnectionFactory) &#123;</span><br><span class="line">        DefaultJmsListenerContainerFactory bean = <span class="keyword">new</span> DefaultJmsListenerContainerFactory();</span><br><span class="line">        bean.setConnectionFactory(activeMQConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>生产者</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;producer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JmsMessagingTemplate jmsTemplate;</span><br><span class="line">    <span class="comment">// 发送消息，destination是发送到的队列，message是待发送的消息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(Destination destination, <span class="keyword">final</span> String message)</span></span>&#123;</span><br><span class="line">        jmsTemplate.convertAndSend(destination, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>消费者类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(JMSConsumer3.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JmsListener(destination = JmsConfig.TOPIC,containerFactory = &quot;jmsListenerContainerTopic&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTopicMessage1</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;接收到topic消息：&#123;&#125;&quot;</span>,msg);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="meta">@JmsListener(destination = JmsConfig.TOPIC,containerFactory = &quot;jmsListenerContainerTopic&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTopicMessage2</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;接收到topic消息：&#123;&#125;&quot;</span>,msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JmsListener(destination = JmsConfig.QUEUE,containerFactory = &quot;jmsListenerContainerQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onQueueMessage</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;接收到queue消息：&#123;&#125;&quot;</span>,text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> Topic topic;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> Queue queue;</span><br><span class="line">   </span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJms</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++) &#123;</span><br><span class="line">          jmsProducer.sendMessage(queue,<span class="string">&quot;queue,world!&quot;</span> + i);</span><br><span class="line">          jmsProducer.sendMessage(topic, <span class="string">&quot;topic,world!&quot;</span> + i);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="12-5-RocketMQ消息队列介绍"><a href="#12-5-RocketMQ消息队列介绍" class="headerlink" title="12.5-RocketMQ消息队列介绍"></a>12.5-RocketMQ消息队列介绍</h3><p>RocketMQ 是一款分布式、队列模型的消息中间件</p>
<p><strong>特点：</strong></p>
<ul>
<li>在高压下1毫秒内响应延迟超过99.6％。</li>
<li>适合金融类业务，高可用性跟踪和审计功能。</li>
<li>支持发布订阅模型，和点对点</li>
<li>支持拉pull和推push两种消息模式</li>
<li>单一队列百万消息</li>
<li>支持单master节点，多master节点，多master多slave节点</li>
</ul>
<p><strong>概念：</strong></p>
<ul>
<li>Producer:消息生产者</li>
<li>Producer Group:消息生产者组，发送同类消息的一个消息生产组</li>
<li>Consumer:消费者</li>
<li>Consumer Group:消费同个消息的多个实例</li>
<li>Tag:标签，子主题（二级分类）,用于区分同一个主题下的不同业务的消息</li>
<li>Topic:主题</li>
<li>Message：消息</li>
<li>Broker：MQ程序，接收生产的消息，提供给消费者消费的程序</li>
<li>Name Server：给生产和消费者提供路由信息，提供轻量级的服务发现和路由    </li>
</ul>
<p><strong>官网地址</strong>：<a target="_blank" rel="noopener" href="http://rocketmq.apache.org/">http://rocketmq.apache.org/</a></p>
<h3 id="12-6-Springboot2整合RocketMQ4-x实战"><a href="#12-6-Springboot2整合RocketMQ4-x实战" class="headerlink" title="12.6-Springboot2整合RocketMQ4.x实战"></a>12.6-Springboot2整合RocketMQ4.x实战</h3><ol>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.rocketmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rocketmq-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置文件</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">rocketmq:</span></span><br><span class="line">  <span class="comment"># 生产者配置</span></span><br><span class="line">  <span class="attr">producer:</span></span><br><span class="line">    <span class="attr">isOnOff:</span> <span class="string">on</span></span><br><span class="line">    <span class="comment"># 发送同一类消息的设置为同一个group，保证唯一</span></span><br><span class="line">    <span class="attr">groupName:</span> <span class="string">FeePlatGroup</span></span><br><span class="line">    <span class="comment"># 服务地址</span></span><br><span class="line">    <span class="attr">namesrvAddr:</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.207</span><span class="string">:9876</span></span><br><span class="line">    <span class="comment"># 消息最大长度 默认1024*4(4M)</span></span><br><span class="line">    <span class="attr">maxMessageSize:</span> <span class="number">4096</span></span><br><span class="line">    <span class="comment"># 发送消息超时时间,默认3000</span></span><br><span class="line">    <span class="attr">sendMsgTimeout:</span> <span class="number">3000</span></span><br><span class="line">    <span class="comment"># 发送消息失败重试次数，默认2</span></span><br><span class="line">    <span class="attr">retryTimesWhenSendFailed:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># 消费者配置</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="attr">isOnOff:</span> <span class="string">on</span></span><br><span class="line">    <span class="comment"># 官方建议：确保同一组中的每个消费者订阅相同的主题。</span></span><br><span class="line">    <span class="attr">groupName:</span> <span class="string">FeePlatGroup</span></span><br><span class="line">    <span class="comment"># 服务地址</span></span><br><span class="line">    <span class="attr">namesrvAddr:</span> <span class="number">10.1</span><span class="number">.1</span><span class="number">.207</span><span class="string">:9876</span></span><br><span class="line">    <span class="comment"># 接收该 Topic 下所有 Tag</span></span><br><span class="line">    <span class="attr">topics:</span> <span class="string">FangPlatTopic~*;</span></span><br><span class="line">    <span class="attr">consumeThreadMin:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">consumeThreadMax:</span> <span class="number">64</span></span><br><span class="line">    <span class="comment"># 设置一次消费消息的条数，默认为1条</span></span><br><span class="line">    <span class="attr">consumeMessageBatchMaxSize:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 Group  Topic  Tag</span></span><br><span class="line"><span class="attr">fang-plat:</span></span><br><span class="line">  <span class="attr">fang-plat-group:</span> <span class="string">FangPlatGroup</span></span><br><span class="line">  <span class="attr">fang-plat-topic:</span> <span class="string">FangPlatTopic</span></span><br><span class="line">  <span class="attr">fang-account-tag:</span> <span class="string">FangAccountTag</span></span><br></pre></td></tr></table></figure></li>
<li><p>生产者配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//RocketMQ生产者配置</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(ProducerConfig.class) ;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.producer.groupName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.producer.namesrvAddr&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String namesrvAddr;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.producer.maxMessageSize&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxMessageSize ;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.producer.sendMsgTimeout&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer sendMsgTimeout;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.producer.retryTimesWhenSendFailed&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer retryTimesWhenSendFailed;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultMQProducer <span class="title">getRocketMQProducer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultMQProducer producer;</span><br><span class="line">        producer = <span class="keyword">new</span> DefaultMQProducer(<span class="keyword">this</span>.groupName);</span><br><span class="line">        producer.setNamesrvAddr(<span class="keyword">this</span>.namesrvAddr);</span><br><span class="line">        <span class="comment">//如果需要同一个jvm中不同的producer往不同的mq集群发送消息，需要设置不同的instanceName</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.maxMessageSize!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            producer.setMaxMessageSize(<span class="keyword">this</span>.maxMessageSize);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.sendMsgTimeout!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            producer.setSendMsgTimeout(<span class="keyword">this</span>.sendMsgTimeout);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果发送消息失败，设置重试次数，默认为2次</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.retryTimesWhenSendFailed!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            producer.setRetryTimesWhenSendFailed(<span class="keyword">this</span>.retryTimesWhenSendFailed);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            producer.start();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MQClientException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> producer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>消费者配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//消费者配置</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(ConsumerConfig.class) ;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.consumer.namesrvAddr&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String namesrvAddr;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.consumer.groupName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.consumer.consumeThreadMin&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> consumeThreadMin;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.consumer.consumeThreadMax&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> consumeThreadMax;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.consumer.topics&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String topics;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;rocketmq.consumer.consumeMessageBatchMaxSize&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> consumeMessageBatchMaxSize;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RocketMsgListener msgListener;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultMQPushConsumer <span class="title">getRocketMQConsumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DefaultMQPushConsumer consumer = <span class="keyword">new</span> DefaultMQPushConsumer(groupName);</span><br><span class="line">        consumer.setNamesrvAddr(namesrvAddr);</span><br><span class="line">        consumer.setConsumeThreadMin(consumeThreadMin);</span><br><span class="line">        consumer.setConsumeThreadMax(consumeThreadMax);</span><br><span class="line">        consumer.registerMessageListener(msgListener);</span><br><span class="line">        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_LAST_OFFSET);</span><br><span class="line">        consumer.setConsumeMessageBatchMaxSize(consumeMessageBatchMaxSize);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String[] topicTagsArr = topics.split(<span class="string">&quot;;&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String topicTags : topicTagsArr) &#123;</span><br><span class="line">                String[] topicTag = topicTags.split(<span class="string">&quot;~&quot;</span>);</span><br><span class="line">                consumer.subscribe(topicTag[<span class="number">0</span>],topicTag[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            consumer.start();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (MQClientException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> consumer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>消费者监听配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//消费监听配置</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RocketMsgListener</span> <span class="keyword">implements</span> <span class="title">MessageListenerConcurrently</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(RocketMsgListener.class) ;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ParamConfigService paramConfigService ;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(list))&#123;</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125;</span><br><span class="line">        MessageExt messageExt = list.get(<span class="number">0</span>);</span><br><span class="line">        LOG.info(<span class="string">&quot;接受到的消息为：&quot;</span>+<span class="keyword">new</span> String(messageExt.getBody()));</span><br><span class="line">        <span class="keyword">int</span> reConsume = messageExt.getReconsumeTimes();</span><br><span class="line">        <span class="comment">// 消息已经重试了3次，如果不需要再次消费，则返回成功</span></span><br><span class="line">        <span class="keyword">if</span>(reConsume ==<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(messageExt.getTopic().equals(paramConfigService.feePlatTopic))&#123;</span><br><span class="line">            String tags = messageExt.getTags() ;</span><br><span class="line">            <span class="keyword">switch</span> (tags)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;FeeAccountTag&quot;</span>:</span><br><span class="line">                    LOGGER.info(<span class="string">&quot;开户 tag == &gt;&gt;&quot;</span>+tags);</span><br><span class="line">                    <span class="keyword">break</span> ;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    LOGGER.info(<span class="string">&quot;未匹配到Tag == &gt;&gt;&quot;</span>+tags);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 消息消费成功</span></span><br><span class="line">        <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>配置参数绑定</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamConfigService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fang-plat.fang-plat-group&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String fangPlatGroup ;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fang-plat.fang-plat-topic&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String fangPlatTopic ;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fang-plat.fang-account-tag&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String fangAccountTag ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeePlatMqServiceImpl</span> <span class="keyword">implements</span> <span class="title">FeePlatMqService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DefaultMQProducer defaultMQProducer;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ParamConfigService paramConfigService ;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SendResult <span class="title">openAccountMsg</span><span class="params">(String msgInfo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 可以不使用Config中的Group</span></span><br><span class="line">        defaultMQProducer.setProducerGroup(paramConfigService.fangPlatGroup);</span><br><span class="line">        SendResult sendResult = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Message sendMsg = <span class="keyword">new</span> Message(paramConfigService.fangPlatTopic,</span><br><span class="line">                                          paramConfigService.fangAccountTag,</span><br><span class="line">                                         <span class="string">&quot;fang_open_account_key&quot;</span>, msgInfo.getBytes());</span><br><span class="line">            sendResult = defaultMQProducer.send(sendMsg);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sendResult ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="13-SpringBoot多环境配置"><a href="#13-SpringBoot多环境配置" class="headerlink" title="13-SpringBoot多环境配置"></a>13-SpringBoot多环境配置</h2><h3 id="13-1-SpringBoot多环境配置介绍"><a href="#13-1-SpringBoot多环境配置介绍" class="headerlink" title="13.1-SpringBoot多环境配置介绍"></a>13.1-SpringBoot多环境配置介绍</h3><ol>
<li>不同环境使用不同配置<br>例如数据库配置，在开发的时候，我们一般用开发数据库，而在生产环境的时候，我们是用正式的数据</li>
<li>配置文件存放路径<br><code>classpath</code>根目录的“/config”包下<br><code>classpath</code>的根目录下</li>
<li>spring boot允许通过命名约定按照一定的格式<code>(application-&#123;profile&#125;.properties)</code>来定义多个配置文件</li>
<li><code>spring.profiles.active=dev</code>来指定加载哪个环境的配置文件</li>
</ol>
<h2 id="14-SpringBoot2-0响应式编程（Webflux）"><a href="#14-SpringBoot2-0响应式编程（Webflux）" class="headerlink" title="14-SpringBoot2.0响应式编程（Webflux）"></a>14-SpringBoot2.0响应式编程（Webflux）</h2><h3 id="14-1-什么是reactive响应式编程（反应式编程）？"><a href="#14-1-什么是reactive响应式编程（反应式编程）？" class="headerlink" title="14.1-什么是reactive响应式编程（反应式编程）？"></a>14.1-什么是reactive响应式编程（反应式编程）？</h3><p>是一种异步编程范式，它关注数据流和变化的传播。这意味着可以通过使用编程语言轻松地表示静态（例如数组）和动态（例如事件发射器）数据流。</p>
<p>响应式编程是一种流行的编程方法，编写代码是基于对变化的反应。它的灵感来自于我们的日常生活，也即我们如何采取行动以及与他人沟通。</p>
<p>我们在执行日常生活活动时，我们会尽可能多任务，但大脑无法处理多任务，不管我们如何努力去做。我们人类实现多任务的唯一办法是在时间线上在任务之间切换。事实上，我们总是切换任务，即使我们没有意识到它。</p>
<p>例如，要执行一个任务：在星巴克喝一杯咖啡饮料，你需要发出一个命令，等待它准备好，然后接受你的饮料。当你在等待的时候，你很可能会找到别的事情做。这是最简单的执行任务的反应(响应)形式，你会在你等待来自咖啡师的“响应”时做别的事情，当你的咖啡已经准备好后，会叫你的名字时。</p>
<p>响应编程能够简化编程，它依赖于事件，代码运行的顺序不是代码行的顺序，而是和一个以上的事件有关，这些事件发生是以随着时间的推移的序列。我们把这一系列事件称为“流”。</p>
<p>何为事件？例如，你知道某个名人总是在发送有趣微博，每次他推发一条微博我们可以称之为一个“事件”。如果你看看这位名人微博系列，你会发现其实是一个随着时间的推移（一系列的事件）发生的一序列的“事件”，响应式编程就是因为我们得“响应”这些事件而得以命名。</p>
<ul>
<li>依赖于事件，事件驱动(Event-driven)</li>
<li>一系列事件称为“流”</li>
<li>异步</li>
<li>非阻塞</li>
<li>观察者模式</li>
</ul>
<p><strong>例子</strong></p>
<p><code>int A = B + C;</code></p>
<p>A被赋值为B和C的值。这时，如果我们改变B的值，A的值并不会随之改变。而如果我们运用一种机制，当B或者C的值发现变化的时候，A的值也随之改变，这样就实现了”响应式“。</p>
<h3 id="14-2-SpringBoot2-x响应式编程webflux介绍"><a href="#14-2-SpringBoot2-x响应式编程webflux介绍" class="headerlink" title="14.2-SpringBoot2.x响应式编程webflux介绍"></a>14.2-SpringBoot2.x响应式编程webflux介绍</h3><ol>
<li><p>Spring WebFlux是Spring Framework 5.0中引入的新的反应式Web框架，与Spring MVC不同，它不需要Servlet API，完全异步和非阻塞，并 通过Reactor项目实现Reactive Streams规范。</p>
<ul>
<li><p>传统的Servlet</p>
<p>servlet由servlet container进行生命周期管理。container启动时构造servlet对象并调用servlet init()进行初始化；container关闭时调用servlet destory()销毁servlet；container运行时接受请求，并为每个请求分配一个线程（一般从线程池中获取空闲线程）然后调用service()。</p>
</li>
</ul>
<p> <img src="https://gitee.com/lemon-cs/images/raw/master/servlet.jpg"></p>
<p>  <strong>缺点：</strong></p>
<p>  servlet是一个简单的网络编程模型，当请求进入servlet container时，servlet container就会为其绑定一个线程，在并发不高的场景下这种模型是适用的，但是一旦并发上升，线程数量就会上涨，而线程资源代价是昂贵的（上线文切换，内存消耗大）严重影响请求的处理时间。在一些简单的业务场景下，不希望为每个request分配一个线程，只需要1个或几个线程就能应对极大并发的请求，这种业务场景下servlet模型就较为吃力。</p>
<p>  <strong>例如：</strong></p>
<p>  spring webmvc是基于servlet之上的一个路由模型，即spring实现了处理所有request请求的一个servlet（DispatcherServlet），并由该servlet进行路由。所以spring webmvc无法摆脱servlet模型的弊端。</p>
<ul>
<li><p>Webflux</p>
<p>Webflux模式替换了旧的Servlet线程模型。用少量的线程处理request和response io操作，这些线程称为Loop线程，而业务交给响应式编程框架处理，响应式编程是非常灵活的，用户可以将业务中阻塞的操作提交到响应式框架的work线程中执行，而不阻塞的操作依然可以在Loop线程中进行处理，大大提高了Loop线程的利用率。</p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/webflux.jpg"></p>
<p>Spring WebFlux是Spring Framework 5.0中引入的新的反应式Web框架，与Spring MVC不同，它不需要Servlet API，完全异步和非阻塞，并 通过Reactor项目实现Reactive Streams规范。</p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/mvc%E5%92%8Cwebflux.jpg"></p>
<p><strong>响应式与非响应式区别：</strong></p>
</li>
</ul>
<p> <img src="https://gitee.com/lemon-cs/images/raw/master/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%92%8C%E9%9D%9E%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8C%BA%E5%88%AB.jpg"></p>
</li>
<li><p>Flux和Mono</p>
<ul>
<li><p>简单业务而言：和其他普通对象差别不大，复杂请求业务，就可以提升性能</p>
</li>
<li><p>通俗理解：</p>
<ul>
<li><p>Mono 表示的是包含 0 或者 1 个元素的异步序列</p>
<p><code>mono-&gt;单一对象 User  如： redis-&gt;用户ID-&gt;唯一的用户Mono&lt;User&gt;</code> </p>
</li>
<li><p>Flux 表示的是包含 0 到 N 个元素的异步序列</p>
<p><code>flux-&gt;数组列表对象 List&lt;User&gt;  如： redis-&gt;男性用户-&gt;Flux&lt;User&gt;</code></p>
</li>
<li><p>Flux 和 Mono 之间可以进行转换</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Spring WebFlux有两种风格：基于功能和基于注解的。基于注解非常接近Spring MVC模型</p>
<ul>
<li><p>基于注解的方式</p>
<p><strong>业务层Service：</strong>调用了ReactiveRedisTemplate对数据进行操作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactiveServiceImpl</span> <span class="keyword">implements</span> <span class="title">ReactiveService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ReactiveRedisTemplate reactiveRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String USER_KEY = <span class="string">&quot;entity:user&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reactiveRedisTemplate.opsForHash().values(USER_KEY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title">queryByUUID</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reactiveRedisTemplate.opsForHash().get(USER_KEY,name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Boolean&gt; <span class="title">add</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        String uuid = generateUUID();</span><br><span class="line">        user.setUuid(uuid);</span><br><span class="line">        <span class="keyword">return</span> reactiveRedisTemplate.opsForHash().put(USER_KEY,user.getUuid(),user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">generateUUID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Boolean&gt; <span class="title">update</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reactiveRedisTemplate.opsForHash().put(USER_KEY,user.getUuid(),user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Boolean&gt; <span class="title">delete</span><span class="params">(String uuid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reactiveRedisTemplate.opsForHash().delete(uuid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Controller层：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactiveController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ReactiveService reactiveService;</span><br><span class="line">    <span class="comment">// 查询所有</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/find/all&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reactiveService.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查询单个</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/query/&#123;uuid&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title">queryByName</span><span class="params">(<span class="meta">@PathVariable(&quot;uuid&quot;)</span> String uuid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reactiveService.queryByUUID(uuid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加用户</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Boolean&gt; <span class="title">add</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> reactiveService.add(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新用户</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Boolean&gt; <span class="title">update</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reactiveService.update(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除用户</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/delete/&#123;uuid&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Boolean&gt; <span class="title">delete</span><span class="params">(<span class="meta">@PathVariable(&quot;uuid&quot;)</span> String uuid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> reactiveService.delete(uuid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和使用mvc没有任何的区别，唯一的区别在于返回的对象是<code>Mono</code>和<code>Flux</code>，简单点理解，返回单个数据就是<code>Mono</code>，多个就使用<code>Flux</code>。</p>
<p>启动项目可以看到实际上使用的是<code>Netty</code>服务器</p>
</li>
<li><p>基于功能（函数式）</p>
<p>处理请求的类，实现具体的业务逻辑，接口 <code>ServerRequest</code> 表示的是一个 HTTP 请求体。通过ServerRequest 对象可获取到请求的相关信息，如请求路径、查询参数和请求内容等。方法 的返回值是一个 Mono<T extends ServerResponse>对象。接口 <code>ServerResponse</code> 用来表示 HTTP 响应。ServerResponse 中包含了很多静态方法来创建不同 HTTP 状态码的响应对象。</p>
<p>涉及几个比较重要的类如：<code>RouterFunction、HandlerFunction和DispatcherHandler</code></p>
<p><code>RouterFunction</code>就是一个路由函数，可以理解为将请求和具体的<code>HandlerFunction</code>做一个映射；</p>
<ol>
<li><p>先创建<code>RouterFunction</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserFunctionRouter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserHandler userHandler;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;userRouter&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouterFunction <span class="title">router</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RouterFunction&lt;ServerResponse&gt; routerFunction = route()</span><br><span class="line">                .GET(<span class="string">&quot;/user/find/all&quot;</span>, accept(MediaType.APPLICATION_JSON_UTF8), userHandler::findAll)</span><br><span class="line">                .GET(<span class="string">&quot;/user/query/&#123;uuid&#125;&quot;</span>, accept(MediaType.APPLICATION_JSON), userHandler::queryByName)</span><br><span class="line">                .POST(<span class="string">&quot;/user/add&quot;</span>, accept(MediaType.APPLICATION_JSON_UTF8),userHandler::add)</span><br><span class="line">                .PUT(<span class="string">&quot;/user/update&quot;</span>, accept(MediaType.APPLICATION_JSON_UTF8),userHandler::update)</span><br><span class="line">                .DELETE(<span class="string">&quot;/user/delete/&#123;uuid&#125;&quot;</span>,accept(MediaType.APPLICATION_JSON_UTF8), userHandler::delete)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> routerFunction;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将具体的请求路径和具体的handler做了映射，这样会根据用户具体的请求路径找具体的handler，其实就是具体的方法。和mvc的@RequestMapping功能上是一样的。但是这个需要注意的是返回的结果是ServerResponse，请求是ServerRequest，这个也可以和mvc的HttpServletRequest、HttpServletResponse对应起来，都是封装用户的请求信息，其实和mvc都还是能对应起来的，只是编程方式不太一样。</p>
</li>
<li><p>然后创建<code>HandlerFunction</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono <span class="title">findAll</span><span class="params">(ServerRequest serverRequest)</span> </span>&#123;</span><br><span class="line">        Flux&lt;User&gt; flux = userRepository.findAll();</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().contentType(MediaType.APPLICATION_JSON_UTF8).body(flux, User.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查询单个</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono <span class="title">queryByUUID</span><span class="params">(ServerRequest serverRequest)</span> </span>&#123;</span><br><span class="line">        String uuid = serverRequest.pathVariable(<span class="string">&quot;uuid&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().contentType(MediaType.APPLICATION_JSON_UTF8).body(userRepository.queryByUUID(uuid),User.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono <span class="title">add</span><span class="params">(ServerRequest serverRequest)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 将请求体转成指定Momo对象</span></span><br><span class="line">        Mono&lt;User&gt; mono = serverRequest.bodyToMono(User.class);</span><br><span class="line">        String uuid = generateUUID();</span><br><span class="line">        <span class="comment">// 方法2</span></span><br><span class="line">        Mono&lt;Object&gt; safeUser = mono.doOnNext(u -&gt; u.setUuid(uuid)).map(user -&gt; &#123;<span class="keyword">return</span> userRepository.saveUser(user);&#125;);</span><br><span class="line"><span class="comment">//        User user = createUser(serverRequest);</span></span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().contentType(MediaType.APPLICATION_JSON_UTF8).body(safeUser,Object.class);</span><br><span class="line">           <span class="comment">//方法1</span></span><br><span class="line"><span class="comment">//        Mono&lt;User&gt; userMono = mono.doOnNext(u -&gt; u.setUuid(uuid)).doOnSuccess(user -&gt; userRepository.saveNoReturn(user));</span></span><br><span class="line"><span class="comment">//        return ServerResponse.ok().contentType(MediaType.APPLICATION_JSON_UTF8).body(userMono,User.class);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> User <span class="title">createUser</span><span class="params">(ServerRequest serverRequest)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        Optional&lt;String&gt; userId = serverRequest.queryParam(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line">        Optional&lt;String&gt; userName = serverRequest.queryParam(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        Optional&lt;String&gt; age = serverRequest.queryParam(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        Optional&lt;String&gt; sex = serverRequest.queryParam(<span class="string">&quot;sex&quot;</span>);</span><br><span class="line">        Optional&lt;String&gt; uuid = serverRequest.queryParam(<span class="string">&quot;uuid&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (userId.isPresent()) user.setUserId(userId.get());</span><br><span class="line">        <span class="keyword">if</span> (userName.isPresent()) user.setUserName(userName.get());</span><br><span class="line">        <span class="keyword">if</span> (age.isPresent()) user.setAge(Integer.valueOf(age.get()));</span><br><span class="line">        <span class="keyword">if</span> (sex.isPresent()) user.setSex(sex.get());</span><br><span class="line">        <span class="keyword">if</span> (uuid.isPresent()) &#123;</span><br><span class="line">            user.setUuid(uuid.get());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            user.setUuid(generateUUID());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono <span class="title">update</span><span class="params">(ServerRequest serverRequest)</span> </span>&#123;</span><br><span class="line">        Mono&lt;User&gt; mono = serverRequest.bodyToMono(User.class);</span><br><span class="line">        User user = createUser(serverRequest);</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().body(userRepository.update(user),Boolean.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono <span class="title">delete</span><span class="params">(ServerRequest serverRequest)</span> </span>&#123;</span><br><span class="line">        String uuid = serverRequest.pathVariable(<span class="string">&quot;uuid&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ServerResponse.ok().body(userRepository.delete(uuid),Long.class);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">generateUUID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
</li>
<li><p>Spring WebFlux应用程序不严格依赖于Servlet API，因此它们不能作为war文件部署，也不能使用src/main/webapp目录</p>
</li>
<li><p>可以整合多个模板引擎</p>
<pre><code>除了REST Web服务外，您还可以使用Spring WebFlux提供动态HTML内容。Spring WebFlux支持各种模板技术，包括Thymeleaf，FreeMarker。
</code></pre>
</li>
</ol>
<h3 id="14-3-SpringBoot2-x-webflux实战"><a href="#14-3-SpringBoot2-x-webflux实战" class="headerlink" title="14.3-SpringBoot2.x webflux实战"></a>14.3-SpringBoot2.x webflux实战</h3><ol>
<li><p>WebFlux中，请求和响应不再是WebMVC中的ServletRequest和ServletResponse，而是ServerRequest和ServerResponse</p>
</li>
<li><p>加入依赖，如果同时存在spring-boot-starter-web，则会优先用spring-boot-starter-web</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写测试类UserController</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;String&gt; <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.just(<span class="string">&quot;hello webflux!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>启动方式默认是Netty,8080端口</p>
<p>测试:localhost:8080/api/v1/user/test</p>
<p><img src="https://gitee.com/lemon-cs/images/raw/master/webflux%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.jpg"></p>
</li>
</ol>
<h3 id="14-4-WebFlux客户端WebClient"><a href="#14-4-WebFlux客户端WebClient" class="headerlink" title="14.4-WebFlux客户端WebClient"></a>14.4-WebFlux客户端WebClient</h3><p>WebClient是一个响应式客户端，它提供了RestTemplate的替代方法。它公开了一个功能齐全、流畅的API，并依赖于非阻塞I / O，使其能够比RestTemplate更高效地支持高并发性。WebClient非常适合流式的传输方案，并且依赖于较低级别的HTTP客户端库来执行请求，是可插拔的。</p>
<p><strong>与RestTemplate相比，WebClient是：</strong></p>
<ul>
<li>非阻塞，Reactive的，并支持更高的并发性和更少的硬件资源。</li>
<li>提供利用Java 8 lambdas的函数API。</li>
<li>支持同步和异步方案。</li>
<li>支持从服务器向上或向下流式传输。</li>
</ul>
<p>RestTemplate不适合在非阻塞应用程序中使用，因此Spring WebFlux应用程序应始终使用WebClient。在大多数高并发场景中，WebClient也应该是Spring MVC中的首选，并且用于编写一系列远程，相互依赖的调用。</p>
<p>Reactive方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> WebClient client = WebClient.create(<span class="string">&quot;http://localhost:8080&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title">getUser</span><span class="params">(Long id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> client.get()</span><br><span class="line">      .uri(<span class="string">&quot;/user/&#123;id&#125;&quot;</span>, id).accept(MediaType.APPLICATION_JSON)</span><br><span class="line">      .retrieve()</span><br><span class="line">      .bodyToMono(User.class);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="15-SpringBoot2-0服务器端主动推送SSE技术"><a href="#15-SpringBoot2-0服务器端主动推送SSE技术" class="headerlink" title="15-SpringBoot2.0服务器端主动推送SSE技术"></a>15-SpringBoot2.0服务器端主动推送SSE技术</h2><h3 id="15-1-服务端推送常用技术介绍"><a href="#15-1-服务端推送常用技术介绍" class="headerlink" title="15.1-服务端推送常用技术介绍"></a>15.1-服务端推送常用技术介绍</h3><ol>
<li><p>客户端轮询:ajax定时拉取</p>
<p>ajax长时间和服务端保持通讯太占内存</p>
</li>
<li><p>服务端主动推送:WebSocket</p>
<pre><code>全双工的，本质上是一个额外的tcp连接，建立和关闭时握手使用http协议，其他数据传输不使用http协议
   更加复杂一些，适用于需要进行复杂双向数据通讯的场景
</code></pre>
<p>​    websocket可以进行服务端和前端双向通讯,写法较为复杂</p>
</li>
<li><p>服务端主动推送:SSE (Server Send Event)</p>
<pre><code>html5新标准，用来从服务端实时推送数据到浏览器端，
   直接建立在当前http连接上，本质上是保持一个http长连接，轻量协议
   简单的服务器数据推送的场景，使用服务器推送事件    
   学习资料：http://www.w3school.com.cn/html5/html_5_serversentevents.asp
</code></pre>
</li>
</ol>
<h3 id="15-2-SpringBoot2-x服务端主动推送SSE"><a href="#15-2-SpringBoot2-x服务端主动推送SSE" class="headerlink" title="15.2-SpringBoot2.x服务端主动推送SSE"></a>15.2-SpringBoot2.x服务端主动推送SSE</h3><ol>
<li><p>后端代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SSEController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//produces = &quot;text/event-stream;charset=UTF-8&quot;一定要带上</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/get_data&quot;, produces = &quot;text/event-stream;charset=UTF-8&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">push</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	  </span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">        	  Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">         &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">double</span> moeny = Math.random()*<span class="number">10</span>;</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;%.2f&quot;</span>,moeny));</span><br><span class="line">    	  DecimalFormat df = <span class="keyword">new</span> DecimalFormat(<span class="string">&quot;.00&quot;</span>);</span><br><span class="line">    	  String price = df.format(moeny);</span><br><span class="line">          <span class="comment">//！！！注意，EventSource返回的参数必须以data:开头，&quot;\n\n&quot;结尾，不然onmessage方法无法执行。</span></span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;data:猪肉价格行情:&quot;</span> + price +<span class="string">&quot;元&quot;</span>+ <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>前段代码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript">  </span></span><br><span class="line"><span class="javascript"><span class="comment">//需要判断浏览器支不支持，可以去w3c进行查看</span></span></span><br><span class="line"><span class="javascript"> </span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> source = <span class="keyword">new</span> EventSource(<span class="string">&#x27;/get_data&#x27;</span>);</span></span><br><span class="line"><span class="javascript">source.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.info(event.data);</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;result&#x27;</span>).innerText = event.data</span></span><br><span class="line"><span class="javascript">&#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="16-SpringBoot2-x监控Actuator"><a href="#16-SpringBoot2-x监控Actuator" class="headerlink" title="16-SpringBoot2.x监控Actuator"></a>16-SpringBoot2.x监控Actuator</h2><p><code>Spring Boot Actuator</code>是<code>spring boot</code>项目一个监控模块，提供了很多原生的端点，包含了对应用系统的自省和监控的集成功能，可以查看应用配置的详细信息，比如<strong>应用程序上下文里全部的Bean</strong>、<strong>健康指标</strong>、<strong>环境变量</strong>及<strong>各类重要度量指标</strong>等等，这些都是使用可<code>HTTP</code>进行请求访问。通过这些监控信息，我们就能随时了解应用的运行情况了。</p>
<p>Actuator 是 Spring Boot 提供的对应用系统的自省和监控功能。通过 Actuator，可以使用数据化的指标去度量应用的运行情况，比如查看服务器的磁盘、内存、CPU等信息，系统的线程、gc、运行状态等等。</p>
<p>Actuator 通常通过使用 HTTP 和 JMX 来管理和监控应用，大多数情况使用 HTTP 的方式。</p>
<ol>
<li><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>添加配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/demo</span></span><br><span class="line"><span class="comment"># actuator 监控配置</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="comment">#actuator端口 如果不配置做默认使用上面8080端口</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="comment">#默认值访问health,info端点  用*可以包含全部端点</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="comment">#修改访问路径 2.0之前默认是/; 2.0默认是/actuator可以通过这个属性值修改</span></span><br><span class="line">      <span class="attr">base-path:</span> <span class="string">/actuator</span></span><br></pre></td></tr></table></figure>

<p>配置完成启动项目后就可以通过postman或者直接在预览器输入路径等方式来查看应用的运行状态了。<br> 当项目启动时，访问<code>[http://127.0.0.1:9090/actuator]</code>地址</p>
<h5 id="注意：如果没有配置-actuator端口-采用默认访问地址：http-127-0-0-1-8080-demo-actuator"><a href="#注意：如果没有配置-actuator端口-采用默认访问地址：http-127-0-0-1-8080-demo-actuator" class="headerlink" title="注意：如果没有配置 actuator端口,采用默认访问地址：http://127.0.0.1:8080/demo/actuator"></a><code>注意：如果没有配置 actuator端口,采用默认访问地址：http://127.0.0.1:8080/demo/actuator</code></h5><p>如果看到类似下面的内容，说明actuator已经生效了</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;_links&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;self&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;auditevents&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/auditevents&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;beans&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/beans&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;caches-cache&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/caches/&#123;cache&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;caches&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/caches&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;health&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/health&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;health-component&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/health/&#123;component&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;health-component-instance&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/health/&#123;component&#125;/&#123;instance&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;conditions&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/conditions&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;configprops&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/configprops&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;env&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/env&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;env-toMatch&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/env/&#123;toMatch&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;info&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/info&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;loggers&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/loggers&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;loggers-name&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/loggers/&#123;name&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;heapdump&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/heapdump&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;threaddump&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/threaddump&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;metrics-requiredMetricName&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/metrics/&#123;requiredMetricName&#125;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;metrics&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/metrics&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;scheduledtasks&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/scheduledtasks&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;httptrace&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/httptrace&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;href&quot;</span>: <span class="string">&quot;http://127.0.0.1:9090/actuator/mappings&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;templated&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>建议</p>
<ul>
<li><p>只能访问几个url</p>
<ul>
<li><p>访问的url在SpringBoot2.0版本需要加上actuator</p>
</li>
<li><p>需要在配置文件中加入下列配置<br><code>management.endpoints.web.exposure.include=*</code></p>
</li>
<li><p>官网说明：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-security-actuator">https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-security-actuator</a></p>
</li>
</ul>
<p><strong>原因：</strong><br>出于安全考虑，除/ health和/ info之外的所有执行器默认都是禁用的。  <code>management.endpoints.web.exposure.include</code>属性可用于启用执行器</p>
</li>
<li><p>建议<br>在设置management.endpoints.web.exposure.include之前，请确保暴露的执行器不包含敏感信息和/<br>或通过将其放置在防火墙进行控制，不对外进行使用</p>
<p>禁用的端点将从应用程序上下文中完全删除。如果您只想更改端点所暴露的技术，请改用 include和exclude属性<br><strong>例子：</strong></p>
<pre><code>开启全部：`management.endpoints.web.exposure.include=*`
开启某个：`management.endpoints.web.exposure.include=metrics`
关闭某个：`management.endpoints.web.exposure.exclude=metrics`
</code></pre>
<p>或者用springadmin进行管理</p>
<pre><code>相关资料：https://www.cnblogs.com/ityouknow/p/8440455.html
</code></pre>
<p>或者用自己编写脚本监控</p>
<pre><code>CPU、内存、磁盘、nginx的http响应状态码200,404,5xx 
</code></pre>
</li>
<li><p>介绍常用的几个</p>
<pre><code>`/health`     查看应用健康指标
  `/actuator/metrics`    查看应用基本指标列表
  `/actuator/metrics/&#123;name&#125;`        通过上述列表，查看具体 查看具体指标
  `/actuator/env`        显示来自Spring的 ConfigurableEnvironment的属性    
</code></pre>
</li>
</ul>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">空白格</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lemon-cs.github.io/2019/12/25/SpringBoot-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">https://lemon-cs.github.io/2019/12/25/SpringBoot-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lemon-cs.github.io" target="_blank">Lemon-CS</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot/">SpringBoot</a><a class="post-meta__tags" href="/tags/Spring/">Spring</a></div><div class="post_share"><div class="social-share" data-image="https://s3.bmp.ovh/imgs/2021/12/6c4bf5b41815150b.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/01/11/Kafka%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src="https://s3.bmp.ovh/imgs/2021/12/53c29bb95b335067.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Kafka入门学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/2019/12/25/SpringBoot-1-x%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="next-cover" src="/./images/scotland.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringBoot-1.x学习笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2019/12/25/SpringBoot-1-x%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="SpringBoot-1.x学习笔记"><img class="cover" src="/./images/scotland.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-25</div><div class="title">SpringBoot-1.x学习笔记</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NTAxNC8zMTQ4Mg=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">空白格</div><div class="author-info__description">杯中的水是亮闪闪的,海里的水是黑沉沉的!</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">6</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lemon-CS"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Lemon-CS" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:591930734@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎来到Lemon-CS</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-SpringBoot2-0%E5%85%A5%E9%97%A8"><span class="toc-text">1-SpringBoot2.0入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-SpringBoot2-x%E4%BE%9D%E8%B5%96%E7%8E%AF%E5%A2%83%E5%92%8C%E7%89%88%E6%9C%AC%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-text">1.1-SpringBoot2.x依赖环境和版本新特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BASpringBoot2-x%E5%BA%94%E7%94%A8%E4%B9%8B%E6%89%8B%E5%B7%A5%E5%88%9B%E5%BB%BAweb%E5%BA%94%E7%94%A8"><span class="toc-text">1.2-快速创建SpringBoot2.x应用之手工创建web应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%BF%AB%E9%80%9F%E5%88%9B%E5%BB%BASpringBoot2-x%E5%BA%94%E7%94%A8%E4%B9%8B%E5%B7%A5%E5%85%B7%E7%B1%BB%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BAweb%E5%BA%94%E7%94%A8"><span class="toc-text">1.3-快速创建SpringBoot2.x应用之工具类自动创建web应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-SpringBoot2-x%E7%9A%84%E4%BE%9D%E8%B5%96%E9%BB%98%E8%AE%A4Maven%E7%89%88%E6%9C%AC"><span class="toc-text">1.4-SpringBoot2.x的依赖默认Maven版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SpringBoot%E6%8E%A5%E5%8F%A3Http%E5%8D%8F%E8%AE%AE%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98"><span class="toc-text">2-SpringBoot接口Http协议开发实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-SpringBoot2-xHTTP%E8%AF%B7%E6%B1%82%E9%85%8D%E7%BD%AE%E8%AE%B2%E8%A7%A3"><span class="toc-text">2.1-SpringBoot2.xHTTP请求配置讲解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%BC%80%E5%8F%91%E5%BF%85%E5%A4%87%E5%B7%A5%E5%85%B7PostMan%E6%8E%A5%E5%8F%A3%E5%B7%A5%E5%85%B7%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-text">2.2-开发必备工具PostMan接口工具介绍和使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-HTTP%E6%8E%A5%E5%8F%A3GET%E8%AF%B7%E6%B1%82%E5%AE%9E%E6%88%98"><span class="toc-text">2.3-HTTP接口GET请求实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-HTTP%E5%85%B6%E4%BB%96%E6%8F%90%E4%BA%A4%E6%96%B9%E6%B3%95%E8%AF%B7%E6%B1%82%E5%AE%9E%E6%88%98"><span class="toc-text">2.4-HTTP其他提交方法请求实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-Post%E8%AF%B7%E6%B1%82"><span class="toc-text">2.4.1-Post请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-Put%E8%AF%B7%E6%B1%82"><span class="toc-text">2.4.2-Put请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-Delete%E8%AF%B7%E6%B1%82"><span class="toc-text">2.4.3-Delete请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Jackson%E4%BD%BF%E7%94%A8"><span class="toc-text">2.5-Jackson使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-SpringBoot%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-text">2.6-SpringBoot目录文件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-SpringBoot%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%AE%9E%E6%88%98"><span class="toc-text">2.7-SpringBoot文件上传实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-jar%E5%8C%85%E6%96%B9%E5%BC%8F%E8%BF%90%E8%A1%8Cweb%E9%A1%B9%E7%9B%AE%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E8%AE%BF%E9%97%AE"><span class="toc-text">2.8-jar包方式运行web项目文件上传和访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-%E6%9E%84%E5%BB%BARESTful-API%E4%B8%8E%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-text">2.9-构建RESTful API与单元测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-%E4%BD%BF%E7%94%A8Swagger2%E6%9E%84%E5%BB%BA%E5%BC%BA%E5%A4%A7%E7%9A%84API%E6%96%87%E6%A1%A3"><span class="toc-text">2.10-使用Swagger2构建强大的API文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-JSR-303%E5%AE%9E%E7%8E%B0%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C"><span class="toc-text">2.11-JSR-303实现请求参数校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JSR-303"><span class="toc-text">JSR-303</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">快速入门</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E6%A0%A1%E9%AA%8C"><span class="toc-text">尝试一些其他校验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SpringBoot%E7%83%AD%E9%83%A8%E7%BD%B2devtool%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98"><span class="toc-text">3-SpringBoot热部署devtool和配置文件自动注入实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E4%BD%BF%E7%94%A8Dev-tool%E7%83%AD%E9%83%A8%E7%BD%B2"><span class="toc-text">3.1-使用Dev-tool热部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-SpringBoot%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">3.2-SpringBoot配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-SpringBoot%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84%E5%88%B0%E5%B1%9E%E6%80%A7%E5%92%8C%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">3.3-SpringBoot注解配置文件自动映射到属性和实体类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Springboot%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E8%BF%9B%E9%98%B6%E5%AE%9E%E6%88%98%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">4-Springboot单元测试进阶实战和自定义异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-SpringBootTest%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%AE%9E%E6%88%98"><span class="toc-text">4.1-SpringBootTest单元测试实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-SpringBoot%E6%B5%8B%E8%AF%95%E4%B9%8BMockMvc%E8%AE%B2%E8%A7%A3"><span class="toc-text">4.2-SpringBoot测试之MockMvc讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E4%BB%80%E4%B9%88%E6%98%AFMock%EF%BC%9F"><span class="toc-text">4.2.1-什么是Mock？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8Mock%E5%AF%B9%E8%B1%A1%EF%BC%9F"><span class="toc-text">4.2.2-为什么使用Mock对象？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-MockMvc"><span class="toc-text">4.2.3-MockMvc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-4-%E5%9C%A8SpringBoot%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-text">4.2.4-在SpringBoot中使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-SpringBoot%E4%B8%AA%E6%80%A7%E5%8C%96%E5%90%AF%E5%8A%A8banner%E8%AE%BE%E7%BD%AE%E5%92%8Cdebug%E6%97%A5%E5%BF%97"><span class="toc-text">4.3-SpringBoot个性化启动banner设置和debug日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-SpringBoot%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-text">4.4-SpringBoot配置全局异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-%E6%A8%A1%E6%8B%9F%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-text">4.4.1-模拟全局异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-%E5%BC%82%E5%B8%B8%E6%B3%A8%E8%A7%A3%E4%BB%8B%E7%BB%8D"><span class="toc-text">4.4.2-异常注解介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-3-%E5%A4%84%E7%90%86%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-text">4.4.3-处理全局异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-4-%E5%A4%84%E7%90%86%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8"><span class="toc-text">4.4.4-处理自定义异常</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-SpringBoot%E9%83%A8%E7%BD%B2war%E9%A1%B9%E7%9B%AE%E5%88%B0tomcat9%E5%92%8C%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86"><span class="toc-text">5-SpringBoot部署war项目到tomcat9和启动原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-SpringBoot%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F%E5%92%8C%E9%83%A8%E7%BD%B2war%E9%A1%B9%E7%9B%AE%E5%88%B0tomcat9"><span class="toc-text">5.1-SpringBoot启动方式和部署war项目到tomcat9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-SpringBoot%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86"><span class="toc-text">5.2-SpringBoot启动原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-SpringBoot%E6%8B%A6%E6%88%AA%E5%99%A8%E5%92%8C-Servlet3-0%E8%87%AA%E5%AE%9A%E4%B9%89Filter%E3%80%81Listener"><span class="toc-text">6-SpringBoot拦截器和 Servlet3.0自定义Filter、Listener</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-SpringBoot%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8CServlet3-0%E9%85%8D%E7%BD%AE%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">6.1-SpringBoot过滤器和Servlet3.0配置过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Servlet3-0%E6%B3%A8%E8%A7%A3%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8E%9F%E7%94%9FServlet"><span class="toc-text">6.2-Servlet3.0注解自定义原生Servlet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E5%90%AC%E5%99%A8Listener"><span class="toc-text">6.3-自定义监听器Listener</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8Interceptor"><span class="toc-text">6.4-自定义拦截器Interceptor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C%E4%B9%8B%E6%95%B4%E5%90%88Mybatis%E5%92%8C%E4%BA%8B%E5%8A%A1"><span class="toc-text">7-数据库操作之整合Mybatis和事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-SpringBoot%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE%E6%96%B9%E5%BC%8F"><span class="toc-text">7.1-SpringBoot持久化数据方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-SpringBoot2-x%E6%95%B4%E5%90%88Mybatis3-x%E6%B3%A8%E8%A7%A3%E5%AE%9E%E6%88%98"><span class="toc-text">7.2-SpringBoot2.x整合Mybatis3.x注解实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-SpringBoot%E6%95%B4%E5%90%88Mybatis%E5%AE%9E%E6%93%8D%E5%92%8C%E6%89%93%E5%8D%B0SQL%E8%AF%AD%E5%8F%A5"><span class="toc-text">7.3-SpringBoot整合Mybatis实操和打印SQL语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D%E5%92%8C%E5%B8%B8%E8%A7%81%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%EF%BC%8C%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="toc-text">7.4-事务介绍和常见的隔离级别，传播行为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-SpringBoot%E6%95%B4%E5%90%88mybatis%E4%B9%8B%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98"><span class="toc-text">7.5-SpringBoot整合mybatis之事务处理实战</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-SpringBoot%E6%95%B4%E5%90%88Redis"><span class="toc-text">8-SpringBoot整合Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98Redis%E4%BB%8B%E7%BB%8D"><span class="toc-text">8.1-分布式缓存Redis介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Redis4-x"><span class="toc-text">8.2-源码编译安装Redis4.x</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-SpringBoot%E6%95%B4%E5%90%88redis%E5%AE%9E%E6%88%98"><span class="toc-text">8.3-SpringBoot整合redis实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-Redis%E9%85%8D%E7%BD%AE%E7%B1%BB%E5%92%8C%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">8.5-Redis配置类和工具类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-SpringBoot%E6%95%B4%E5%90%88%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1"><span class="toc-text">9-SpringBoot整合定时任务和异步任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-SpringBoot%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1schedule"><span class="toc-text">9.1-SpringBoot定时任务schedule</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-SpringBoot%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1"><span class="toc-text">9.2-SpringBoot异步任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-SpringBootz%E6%95%B4%E5%90%88Quartz"><span class="toc-text">9.3-SpringBootz整合Quartz</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Quartz%E7%9A%843%E4%B8%AA%E5%9F%BA%E6%9C%AC%E8%A6%81%E7%B4%A0"><span class="toc-text">Quartz的3个基本要素</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Logback%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D%E5%92%8CSpringBoot%E6%95%B4%E5%90%88"><span class="toc-text">10-Logback日志框架介绍和SpringBoot整合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E6%96%B0%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6LogBack%E4%BB%8B%E7%BB%8D"><span class="toc-text">10.1-新日志框架LogBack介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-SpringBoot2-x%E6%97%A5%E5%BF%97%E8%AE%B2%E8%A7%A3%E5%92%8CLogback"><span class="toc-text">10.2-SpringBoot2.x日志讲解和Logback</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%90%9C%E7%B4%A2%E6%A1%86%E6%9E%B6ElasticSearch%E4%BB%8B%E7%BB%8D%E5%92%8C%E6%95%B4%E5%90%88SpringBoot"><span class="toc-text">11-搜索框架ElasticSearch介绍和整合SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E6%90%9C%E7%B4%A2%E7%9F%A5%E8%AF%86"><span class="toc-text">11.1-搜索知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-ElasticSearch%E4%BB%8B%E7%BB%8D"><span class="toc-text">11.2-ElasticSearch介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-SpringBoot%E6%95%B4%E5%90%88ElasticSearch"><span class="toc-text">11.3-SpringBoot整合ElasticSearch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%BB%8B%E7%BB%8D%E5%92%8CSpringBoot%E6%95%B4%E5%90%88RockketMQ%E3%80%81ActiveMQ"><span class="toc-text">12-消息队列介绍和SpringBoot整合RockketMQ、ActiveMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-JMS%E4%BB%8B%E7%BB%8D%E5%92%8C%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%9F%BA%E7%A1%80%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="toc-text">12.1-JMS介绍和使用场景及基础编程模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-ActiveMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D"><span class="toc-text">12.2-ActiveMQ消息队列基础介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-3-SpringBoot2%E6%95%B4%E5%90%88ActiveMQ%E5%AE%9E%E6%88%98%E4%B9%8B%E7%82%B9%E5%AF%B9%E7%82%B9%E6%B6%88%E6%81%AF"><span class="toc-text">12.3-SpringBoot2整合ActiveMQ实战之点对点消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-4-SpringBoot%E6%95%B4%E5%90%88ActiveMQ%E5%AE%9E%E6%88%98%E4%B9%8B%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">12.4-SpringBoot整合ActiveMQ实战之发布订阅模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-5-RocketMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%BB%8B%E7%BB%8D"><span class="toc-text">12.5-RocketMQ消息队列介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-6-Springboot2%E6%95%B4%E5%90%88RocketMQ4-x%E5%AE%9E%E6%88%98"><span class="toc-text">12.6-Springboot2整合RocketMQ4.x实战</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-SpringBoot%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-text">13-SpringBoot多环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-SpringBoot%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D"><span class="toc-text">13.1-SpringBoot多环境配置介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-SpringBoot2-0%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%EF%BC%88Webflux%EF%BC%89"><span class="toc-text">14-SpringBoot2.0响应式编程（Webflux）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-%E4%BB%80%E4%B9%88%E6%98%AFreactive%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%EF%BC%88%E5%8F%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%EF%BC%89%EF%BC%9F"><span class="toc-text">14.1-什么是reactive响应式编程（反应式编程）？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-SpringBoot2-x%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8Bwebflux%E4%BB%8B%E7%BB%8D"><span class="toc-text">14.2-SpringBoot2.x响应式编程webflux介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-3-SpringBoot2-x-webflux%E5%AE%9E%E6%88%98"><span class="toc-text">14.3-SpringBoot2.x webflux实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-4-WebFlux%E5%AE%A2%E6%88%B7%E7%AB%AFWebClient"><span class="toc-text">14.4-WebFlux客户端WebClient</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-SpringBoot2-0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E4%B8%BB%E5%8A%A8%E6%8E%A8%E9%80%81SSE%E6%8A%80%E6%9C%AF"><span class="toc-text">15-SpringBoot2.0服务器端主动推送SSE技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%8E%A8%E9%80%81%E5%B8%B8%E7%94%A8%E6%8A%80%E6%9C%AF%E4%BB%8B%E7%BB%8D"><span class="toc-text">15.1-服务端推送常用技术介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-SpringBoot2-x%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%BB%E5%8A%A8%E6%8E%A8%E9%80%81SSE"><span class="toc-text">15.2-SpringBoot2.x服务端主动推送SSE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-SpringBoot2-x%E7%9B%91%E6%8E%A7Actuator"><span class="toc-text">16-SpringBoot2.x监控Actuator</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%E9%85%8D%E7%BD%AE-actuator%E7%AB%AF%E5%8F%A3-%E9%87%87%E7%94%A8%E9%BB%98%E8%AE%A4%E8%AE%BF%E9%97%AE%E5%9C%B0%E5%9D%80%EF%BC%9Ahttp-127-0-0-1-8080-demo-actuator"><span class="toc-text">注意：如果没有配置 actuator端口,采用默认访问地址：http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;demo&#x2F;actuator</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/01/05/test/" title="test"><img src="https://s3.bmp.ovh/imgs/2021/12/145436554af6720c.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="test"/></a><div class="content"><a class="title" href="/2021/01/05/test/" title="test">test</a><time datetime="2021-01-04T16:00:00.000Z" title="发表于 2021-01-05 00:00:00">2021-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/02/15/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AF%A6%E8%A7%A3/" title="阿里巴巴Java开发手册详解"><img src="https://s3.bmp.ovh/imgs/2021/12/145436554af6720c.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="阿里巴巴Java开发手册详解"/></a><div class="content"><a class="title" href="/2020/02/15/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C%E8%AF%A6%E8%A7%A3/" title="阿里巴巴Java开发手册详解">阿里巴巴Java开发手册详解</a><time datetime="2020-02-15T12:58:13.000Z" title="发表于 2020-02-15 20:58:13">2020-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/02/01/Docker%E5%AE%89%E8%A3%85Kafka/" title="Docker安装Kafka"><img src="https://s3.bmp.ovh/imgs/2021/12/b7f532171b88483b.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker安装Kafka"/></a><div class="content"><a class="title" href="/2020/02/01/Docker%E5%AE%89%E8%A3%85Kafka/" title="Docker安装Kafka">Docker安装Kafka</a><time datetime="2020-02-01T13:09:50.000Z" title="发表于 2020-02-01 21:09:50">2020-02-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/01/11/Kafka%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Kafka入门学习笔记"><img src="https://s3.bmp.ovh/imgs/2021/12/53c29bb95b335067.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka入门学习笔记"/></a><div class="content"><a class="title" href="/2020/01/11/Kafka%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Kafka入门学习笔记">Kafka入门学习笔记</a><time datetime="2020-01-11T14:09:50.000Z" title="发表于 2020-01-11 22:09:50">2020-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2019/12/25/SpringBoot-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="SpringBoot-2.0学习笔记"><img src="https://s3.bmp.ovh/imgs/2021/12/6c4bf5b41815150b.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot-2.0学习笔记"/></a><div class="content"><a class="title" href="/2019/12/25/SpringBoot-2-0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="SpringBoot-2.0学习笔记">SpringBoot-2.0学习笔记</a><time datetime="2019-12-25T14:09:50.000Z" title="发表于 2019-12-25 22:09:50">2019-12-25</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By 空白格</div><div class="footer_custom_text">欢迎来到Lemon-CS</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (true) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.removeEventListener('scroll', window.tocScrollFn)
  window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>